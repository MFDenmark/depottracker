<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Tidsløft · v10.1.2</title>
<style>
:root{
  --bg1:#0b1a2f;
  --bg2:#0f2a48;
  --card: rgba(255,255,255,0.92);
  --card2: rgba(255,255,255,0.96);
  --text:#0b1220;
  --muted: rgba(11,18,32,0.62);
  --blue1:#2b6cff;
  --blue2:#4aa7ff;
  --line: rgba(11,18,32,0.08);
  --radius:22px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
  background: linear-gradient(160deg,var(--bg1),var(--bg2));
  min-height:100vh;
  line-height:1.55;
}
body::before{
  content:"";
  position:fixed; inset:0;
  background:
    radial-gradient(900px 520px at 20% -10%, rgba(255,255,255,0.09), rgba(255,255,255,0.0) 55%),
    radial-gradient(900px 520px at 80% 0%, rgba(74,167,255,0.10), rgba(255,255,255,0.0) 60%);
  pointer-events:none;
  z-index:-1;
}
.wrap{
  max-width:820px;
  margin:0 auto;
  padding:18px 14px 96px;
}
/* Top progress */
#topBar{
  position:sticky; top:0;
  z-index:30;
  padding:14px 4px 10px;
  background: linear-gradient(180deg, rgba(11,26,47,0.96), rgba(11,26,47,0.72));
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(255,255,255,0.06);
}
.topRow{
  display:flex; align-items:center; justify-content:space-between;
  color:rgba(255,255,255,0.92);
  padding:2px 6px 10px;
  font-weight:700;
  letter-spacing:0.02em;
}
#topStep{font-size:14px}
.progress{
  height:4px; border-radius:4px;
  background:rgba(255,255,255,0.16);
  overflow:hidden;
  margin:0 6px 4px;
}
#progressFill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg,var(--blue1),var(--blue2));
  border-radius:4px;
  transition:width .25s ease;
}
/* Cards */
.card{
  background: var(--card);
  border:1px solid rgba(255,255,255,0.35);
  backdrop-filter: blur(8px);
  border-radius: var(--radius);
  box-shadow: 0 18px 40px rgba(0,0,0,0.18);
}
.hero{
  padding:30px 22px;
}
.huge{
  font-size:42px;
  font-weight:900;
  letter-spacing:-0.02em;
  margin:0 0 12px 0;
}
.p{
  margin:0;
  font-size:18px;
  color: rgba(11,18,32,0.70);
}
.small{
  font-size:12px;
  color: rgba(11,18,32,0.55);
}
.hr{height:1px; background:var(--line); margin:18px 0;}
.cta{
  width:100%;
  border:0;
  padding:16px 18px;
  border-radius: 28px;
  font-weight:800;
  font-size:16px;
  color:white;
  background: linear-gradient(90deg,var(--blue1),var(--blue2));
  box-shadow: 0 14px 30px rgba(43,108,255,0.28);
  cursor:pointer;
}
.cta:active{transform: translateY(1px);}
.btnGhost{
  width:100%;
  border:1px solid rgba(11,18,32,0.10);
  padding:14px 16px;
  border-radius: 26px;
  background: rgba(255,255,255,0.80);
  font-weight:700;
  cursor:pointer;
}
.section{display:none; margin-top:18px;}
.section.active{display:block;}
.formCard{padding:20px 18px;}
.kicker{
  font-size:12px;
  letter-spacing:0.18em;
  color: rgba(11,18,32,0.45);
  font-weight:800;
  text-transform:uppercase;
}
.h1{
  font-size:44px; margin:8px 0 8px; font-weight:950; letter-spacing:-0.03em;
}
.helpRow{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
}
.label{
  font-size:16px; font-weight:900; margin:18px 0 8px;
}
.input{
  width:100%;
  padding:18px 16px;
  border-radius:18px;
  border:1px solid rgba(11,18,32,0.10);
  font-size:30px;
  font-weight:900;
  outline:none;
  background: rgba(255,255,255,0.98);
}
.input::placeholder{color: rgba(11,18,32,0.28); font-weight:800;}
.hint{
  margin-top:8px;
  padding:12px 14px;
  border-radius:14px;
  background: rgba(43,108,255,0.08);
  border:1px solid rgba(43,108,255,0.14);
  color: rgba(11,18,32,0.75);
  font-size:14px;
  display:none;
}
.hint.open{display:block;}
.iconBtn{
  width:34px; height:34px;
  border-radius:999px;
  border:1px solid rgba(11,18,32,0.10);
  background: rgba(255,255,255,0.85);
  display:flex; align-items:center; justify-content:center;
  font-weight:1000;
  cursor:pointer;
  color: rgba(11,18,32,0.70);
}
/* Result */
.resultWrap{padding:18px 18px;}
.metaPills{
  display:flex; gap:10px; flex-wrap:wrap;
  margin-top:8px;
}
.pill{
  padding:10px 12px;
  border-radius:999px;
  background: rgba(43,108,255,0.10);
  border:1px solid rgba(43,108,255,0.16);
  font-weight:800;
  font-size:13px;
}
.bigNum{
  font-size:64px;
  font-weight:1000;
  letter-spacing:-0.05em;
  margin:12px 0 6px;
}
.center{text-align:center;}
/* Actions */
.actionsHeader{
  display:flex; align-items:flex-end; justify-content:space-between;
  gap:12px;
}
.sumBox{
  margin-top:14px;
  padding:14px 14px;
  border-radius:18px;
  background: rgba(255,255,255,0.92);
  border:1px solid rgba(11,18,32,0.08);
}
.sumBox .t{font-weight:950;}
.sumBox .r{float:right; font-weight:950; color: rgba(43,108,255,0.90);}
.actionList{margin-top:12px; display:flex; flex-direction:column; gap:12px;}
.actionCard{
  padding:14px 14px;
  border-radius:18px;
  border:1px solid rgba(11,18,32,0.08);
  background: rgba(255,255,255,0.92);
  display:flex; justify-content:space-between; gap:12px;
  cursor:pointer;
}
.actionCard.selected{
  border-color: rgba(43,108,255,0.45);
  box-shadow: 0 10px 22px rgba(43,108,255,0.18);
}
.actionLeft{
  display:flex; gap:10px;
}
.badge{
  display:inline-flex;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(11,18,32,0.10);
  font-size:12px;
  font-weight:850;
  color: rgba(11,18,32,0.62);
  margin-top:8px;
}
.actionTitle{font-weight:950; font-size:16px;}
.actionSub{font-size:12px; color: rgba(11,18,32,0.55); margin-top:2px;}
.actionRight{
  text-align:right;
  min-width:92px;
}
.effect{
  font-weight:950; color: rgba(43,108,255,0.90);
}
.kr{
  font-weight:900; color: rgba(11,18,32,0.70);
}
/* Assumptions footer link (inline, not fixed) */
.assumpFooter{
  margin-top:18px;
  padding-top:14px;
  border-top:1px solid rgba(11,18,32,0.08);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  font-size:13px;
  color: rgba(11,18,32,0.55);
  cursor:pointer;
  user-select:none;
}
.assumpFooter .i{
  width:22px; height:22px;
  border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  border:1px solid rgba(11,18,32,0.12);
  background: rgba(255,255,255,0.8);
  font-weight:950;
  color: rgba(11,18,32,0.65);
}
.assumpFooter:hover{ color: rgba(11,18,32,0.72); }
/* Modal / sheet */
.backdrop{
  position:fixed; inset:0;
  background: rgba(0,0,0,0.42);
  display:none;
  z-index:80;
}
.backdrop.open{display:block;}
.sheet{
  position:fixed;
  left:0; right:0; bottom:-100%;
  z-index:90;
  transition: bottom .25s ease;
  padding:0 10px 10px;
}
.sheet.open{bottom:0;}
.sheetCard{
  max-width:820px;
  margin:0 auto;
  background: rgba(255,255,255,0.96);
  border:1px solid rgba(11,18,32,0.10);
  border-radius: 22px;
  box-shadow: 0 26px 60px rgba(0,0,0,0.25);
  overflow:hidden;
}
.sheetHead{
  padding:14px 16px;
  display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
  border-bottom:1px solid rgba(11,18,32,0.08);
}
.sheetTitle{font-weight:950; font-size:18px;}
.closeX{
  border:1px solid rgba(11,18,32,0.12);
  background: rgba(255,255,255,0.90);
  border-radius:12px;
  padding:8px 10px;
  font-weight:950;
  cursor:pointer;
}
.sheetBody{
  max-height:62vh;
  overflow:auto;
  padding:14px 16px 18px;
}
.sheetBody h4{margin:14px 0 8px;}
.sheetBody ul{margin:8px 0 0 18px;}
.mono{font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
/* Footer button row */
.row{
  display:flex; gap:12px; margin-top:18px;
}
.row .btnGhost{flex:1}
.row .cta{flex:2}
/* Hide top bar on intro */
body.intro #topBar{display:none;}
</style>
</head>
<body class="intro">
  <div id="topBar">
    <div class="topRow">
      <div id="topStep">TRIN 1 / 5</div>
      <div style="opacity:.0">.</div>
    </div>
    <div class="progress"><div id="progressFill"></div></div>
  </div>

  <div class="wrap">
    <!-- INTRO -->
    <section class="section active" data-step="0" id="s_intro">
      <div class="card hero">
        <div class="huge">Skab tidligere frihed.</div>
        <p class="p">Se hvornår det realistisk kan lade sig gøre – baseret på dine tal.</p>
        <div style="height:18px"></div>
        <button class="cta" data-action="start">Start beregningen</button>
        <div class="small" style="margin-top:10px;">Ingen tilmelding. Tager under 3 minutter.</div>

        <div class="hr"></div>

        <div class="p" style="font-size:16px; margin:0;">Du indtaster tre tal. Vi beregner ét konkret stop-tidspunkt og viser, hvad din plan eventuelt kræver.</div>
        <div style="margin-top:14px; line-height:1.75; font-weight:900;">
          ✔ Konkrete tal – ikke prognoser<br/>
          ✔ Konservative forudsætninger<br/>
          ✔ Ét realistisk stop-tidspunkt
        </div>

        <div class="small" style="margin-top:16px;">Vejledende beregning. Skat og individuelle pensionsordninger indgår ikke.</div>
      </div>
    </section>

    <!-- STEP 1 AGE -->
    <section class="section" data-step="1" id="s_age">
      <div class="card formCard">
        <div class="kicker">TRIN 1/5</div>
        <div class="h1">Din alder</div>
        <div class="p" style="font-size:16px;">Vi estimerer din folkepensionsalder ud fra din alder.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Alder</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintAge" aria-label="Hjælp">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" maxlength="3" id="ageInput" placeholder="fx 46"/>
        <div class="hint" id="hintAge">Indtast din alder i hele år.</div>

        <div style="height:12px"></div>
        <div class="card" style="padding:14px 14px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div class="kicker" style="letter-spacing:0.12em;">FOLKEPENSION (ESTIMAT)</div>
          <div style="display:flex; align-items:baseline; justify-content:space-between; gap:10px;">
            <div class="bigNum mono" style="font-size:54px; margin:8px 0 0;" id="fpAgeBig">—</div>
            <div class="small" style="font-size:14px; font-weight:800;">år</div>
          </div>
        </div>

        <div style="height:16px"></div>
        <button class="cta" data-action="next">Fortsæt</button>
      

<div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Forudsætninger og beregningsmodel">
  <div class="i">i</div>
  <div>Forudsætninger &amp; beregningsmodel</div>
</div>

</div>
    </section>

    <!-- STEP 2 NUMBERS -->
    <section class="section" data-step="2" id="s_numbers">
      <div class="card formCard">
        <div class="kicker">TRIN 2/5</div>
        <div class="h1">Dine tal</div>
        <div class="p" style="font-size:16px;">Felterne har kun forslag (ikke forudfyldte værdier). Du kan altid justere senere.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Opsparing i dag (kr.)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintSav">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="savInput" placeholder="fx 25.000"/>
        <div class="hint" id="hintSav">Din opsparing/investerede formue i dag (ikke pensioner).</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Månedlig investering (kr./md)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintInv">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="invInput" placeholder="fx 3.500"/>
        <div class="hint" id="hintInv">Det beløb du realistisk kan investere hver måned frem til stop. Brug et beløb du kan holde over tid.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Ønsket månedlig indkomst før folkepension (kr./md)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintInc">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="incInput" placeholder="fx 35.000"/>
        <div class="hint" id="hintInc">Angiv bruttobeløb. Vi regner uden skat for gennemsigtighed.</div>

        <div style="height:16px"></div>
        <button class="cta" data-action="compute">Se resultat</button>
      

<div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Forudsætninger og beregningsmodel">
  <div class="i">i</div>
  <div>Forudsætninger &amp; beregningsmodel</div>
</div>

</div>
    </section>

    <!-- STEP 3 RESULT -->
    <section class="section" data-step="3" id="s_result">
      <div class="card resultWrap">
        <div class="kicker">TRIN 3/5</div>
        <div class="h1">Dit potentiale</div>
        <div class="p" style="font-size:16px;">Baseret på dine tal lige nu. Små ændringer kan give ekstra frihed.</div>

        <div class="metaPills">
          <div class="pill">Din alder: <span class="mono" id="curAgeLbl">—</span></div>
          <div class="pill">Folkepension: <span class="mono" id="fpAgeLbl">—</span></div>
        </div>

        <div class="center">
          <div class="bigNum mono" id="stopAgeLbl">—</div>
          <div style="font-weight:900; font-size:18px;">din mulige stop-alder</div>
          <div class="p" style="font-size:15px; margin-top:6px;" id="stopSub">—</div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <button class="btnGhost" data-action="backToNumbers">Tilbage</button>
          <button class="cta" data-action="toActions">Forbedr min plan</button>
        </div>

        <div style="height:12px"></div>
        <button class="btnGhost" data-action="openLead">Ønsker du sparring? Få kontakt til rådgiver</button>
      

<div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Forudsætninger og beregningsmodel">
  <div class="i">i</div>
  <div>Forudsætninger &amp; beregningsmodel</div>
</div>

</div>
    </section>

    <!-- STEP 4 ACTIONS -->
    <section class="section" data-step="4" id="s_actions">
      <div class="card formCard">
        <div class="kicker">TRIN 4/5</div>
        <div class="h1" style="font-size:40px;">Små ændringer</div>
        <div class="p" style="font-size:16px;">Vælg konkrete greb. Vi viser kun forslag med mindst 1 måned effekt.</div>

        <div class="sumBox">
          <div><span class="t">Samlet frihedsløft</span> <span class="r" id="sumLift">+0 md</span></div>
          <div class="small" style="margin-top:4px;">Effekten vises som potentiale, hvis du kan frigøre beløbet.</div>
        </div>

        <div class="actionList" id="actionList"></div>

        <div class="hr"></div>
        <div class="row">
          <button class="btnGhost" data-action="backToResult">Tilbage</button>
          <button class="cta" data-action="toNewResult">Se nyt resultat</button>
        </div>

        <div style="height:12px"></div>
        <button class="btnGhost" data-action="openLead">Få kontakt til rådgiver</button>
      

<div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Forudsætninger og beregningsmodel">
  <div class="i">i</div>
  <div>Forudsætninger &amp; beregningsmodel</div>
</div>

</div>
    </section>

    
    <!-- STEP 5 NEW RESULT -->
    <section class="section" data-step="5" id="s_newresult">
      <div class="card resultWrap">
        <div class="kicker">TRIN 5/5</div>
        <div class="h1">Nyt resultat</div>
        <div class="p" style="font-size:16px;">Med dine valgte ændringer.</div>

        <div class="metaPills">
          <div class="pill">Oprindeligt: <span class="mono" id="baseStopLbl">—</span> år</div>
          <div class="pill">Nyt estimat: <span class="mono" id="newStopLbl">—</span> år</div>
          <div class="pill">Løft: <span class="mono" id="newLiftLbl">—</span></div>
        </div>

        <div class="center" style="margin-top:10px;">
          <div class="bigNum mono" id="newStopBig">—</div>
          <div style="font-weight:900; font-size:18px;">din mulige stop-alder</div>
          <div class="p" style="font-size:15px; margin-top:6px;" id="newStopSub">—</div>
        </div>

        <div class="hr"></div>

        <div class="card" style="padding:16px 16px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div style="font-weight:950; font-size:18px;">Ikke tilfreds?</div>
          <div class="p" style="font-size:15px; margin-top:6px;">Se hvad der realistisk skal til for at stoppe endnu tidligere.</div>
          <div style="height:10px"></div>
          <button class="cta" data-action="openWhatItTakes">Se hvad der skal til</button>
        </div>

        <div style="height:14px"></div>

        <div class="card" style="padding:16px 16px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div style="font-weight:950; font-size:18px;">Ønsker du sparring på din plan?</div>
          <div class="p" style="font-size:15px; margin-top:6px;">Få en uforpligtende gennemgang af dine tal og muligheder med en rådgiver.</div>
          <div style="height:10px"></div>
          <button class="cta" data-action="openLead">Book en uforpligtende samtale</button>
          <div class="small" style="margin-top:10px;">Du kontaktes kun hvis du selv sender din forespørgsel og giver samtykke.</div>
        </div>

        <div class="hr"></div>
        <div class="row">
          <button class="btnGhost" data-action="backToActions">Tilbage</button>
          <button class="btnGhost" data-action="restart">Start forfra</button>
        </div>

        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Forudsætninger og beregningsmodel">
          <div class="i">i</div>
          <div>Forudsætninger &amp; beregningsmodel</div>
        </div>
      </div>
    </section>
</div>

  <div class="i">i</div>
  </div>

  <!-- Backdrop + Sheet -->
  <div class="backdrop" id="backdrop"></div>
  <div class="sheet" id="sheet">
    <div class="sheetCard" role="dialog" aria-modal="true" aria-label="Dialog">
      <div class="sheetHead">
        <div class="sheetTitle" id="sheetTitle">Titel</div>
        <button class="closeX" data-action="closeSheet" type="button">Luk</button>
      </div>
      <div class="sheetBody" id="sheetBody"></div>
    </div>
  </div>

<script>
/* =========================
   v10.1.2 New Motor
   ========================= */

// Model constants (must match UI text)
const REAL_RETURN_ANNUAL = 0.04;   // realafkast pr. år (konservativt)
const DISCOUNT_RATE_ANNUAL = 0.02; // diskonteringsrente pr. år (konservativ)
const BRIDGE_BUFFER = 0.10;        // sikkerhedsbuffer på brobehov

// --- deterministic pension age estimate (cap at 70, as before) ---
function pensionAgeByBirthYearApprox(birthYear){
  if (birthYear <= 1962) return 67;
  if (birthYear <= 1966) return 68;
  if (birthYear <= 1970) return 69;
  return 70; // cap (vedtaget loft)
}
function pensionAgeFromCurrentAgeApprox(currentAge){
  // approx birth year with +/-1 uncertainty to avoid false precision
  const y = new Date().getFullYear();
  const by1 = y - currentAge;
  const by2 = y - currentAge - 1;
  const p1 = pensionAgeByBirthYearApprox(by1);
  const p2 = pensionAgeByBirthYearApprox(by2);
  return Math.min(70, Math.max(p1, p2));
}

// --- math ---
function futureValue(savings, monthly, years, rAnnual=REAL_RETURN_ANNUAL){
  const n = Math.max(0, Math.round(years * 12));
  const r = rAnnual/12;
  let fv = savings * Math.pow(1+r, n);
  if (monthly > 0){
    fv += monthly * ((Math.pow(1+r, n)-1)/r);
  }
  return fv;
}
function bridgePV(annualSpend, years, rAnnual=DISCOUNT_RATE_ANNUAL, buffer=BRIDGE_BUFFER){
  const n = Math.max(0, Math.round(years*12));
  const r = rAnnual/12;
  if (n<=0) return 0;
  const pv = (annualSpend/12) * (1 - Math.pow(1+r, -n)) / r;
  return pv * (1+buffer);
}
function solveStopAge(age, pensionAge, savings, monthlyTotal, income){
  // income is desired monthly before pension
  let best = NaN;
  for (let a = age; a <= pensionAge; a += 0.5){
    const t = a - age;
    const fv = futureValue(savings, monthlyTotal, t);
    const bridgeYears = Math.max(0, pensionAge - a);
    const need = bridgePV(income*12, bridgeYears);
    if (fv >= need){ best = a; break; }
  }
  if (Number.isNaN(best)) best = pensionAge;
  return best;
}
function extraMonthlyNeededForGoal(age, goalAge, pensionAge, savings, monthlyBase, income){
  goalAge = Math.min(goalAge, pensionAge);
  const t = Math.max(0, goalAge - age);
  const fvBase = futureValue(savings, monthlyBase, t);
  const need = bridgePV(income*12, Math.max(0, pensionAge - goalAge));
  const gap = Math.max(0, need - fvBase);
  if (gap <= 0) return 0;
  const n = Math.max(1, Math.round(t*12));
  const r = REAL_RETURN_ANNUAL/12;
  const factor = (Math.pow(1+r, n)-1)/r; // FV of 1 kr/month
  const m = gap / factor;
  return Math.ceil(m/50)*50; // round to 50 kr
}
function fmtInt(n){
  if (!isFinite(n)) return "—";
  return Math.round(n).toLocaleString("da-DK");
}
function yearsToMonths(y){ return Math.round(y*12); }

// --- actions library (concrete items) ---
const ACTIONS = [
  {id:"car_less", title:"Én bil mindre i husstanden", monthly:2500, tag:"Større greb"},
  {id:"insurance", title:"Gennemgå forsikringer", monthly:300, tag:"Konkrete greb"},
  {id:"groceries", title:"Strammere dagligvarebudget", monthly:500, tag:"Konkrete greb"},
  {id:"subscriptions", title:"Fjern abonnementer du ikke bruger", monthly:250, tag:"Konkrete greb"},
  {id:"vacation", title:"Færre/enkle ferier (snit pr. md)", monthly:700, tag:"Konkrete greb"},
  {id:"transport", title:"Mindre benzin/transport (snit pr. md)", monthly:400, tag:"Konkrete greb"},
  {id:"takeaway", title:"Mindre takeaway/café", monthly:400, tag:"Konkrete greb"},
  {id:"housing", title:"Lavere boligudgifter (snit pr. md)", monthly:1000, tag:"Større greb"},
];

// --- state ---
const state = {
  step: 0,
  age: null,
  fpAge: null,
  savings: null,
  monthly: null,
  income: null,
  baseStop: null,
  selected: new Set(),
  visibleActions: [],
};

// --- DOM helpers ---
const $ = (id)=>document.getElementById(id);
function setActiveStep(step){
  state.step = step;
  document.body.classList.toggle("intro", step===0);
  document.querySelectorAll(".section").forEach(sec=>{
    const s = Number(sec.getAttribute("data-step"));
    sec.classList.toggle("active", s===step);
  });
  // top bar
  const top = $("topBar");
  if (top) top.style.display = step===0 ? "none":"block";
  if (step>0){
    $("topStep").textContent = `TRIN ${step} / 5`;
    $("progressFill").style.width = `${Math.round((step/5)*100)}%`;
  }
    if (act==="start"){ setActiveStep(1); return; }

  if (act==="toggleHint"){
    const id = el.getAttribute("data-hint");
    const box = $(id);
    if (box) box.classList.toggle("open");
    return;
  }

  if (act==="next"){
    if (!requireAge()) return;
    setActiveStep(2);
    return;
  }

  if (act==="compute"){
    if (!requireNumbers()) return;
    if (!isFinite(state.age)) return;
    if (!state.fpAge) updateFpAge();
    if (!computeBase()) return;
    renderResult();
    setActiveStep(3);
    return;
  }

  if (act==="backToNumbers"){ setActiveStep(2); return; }
  if (act==="toActions"){ renderActions(); setActiveStep(4); return; }
  if (act==="backToResult"){ setActiveStep(3); return; }
  if (act==="toReality"){ renderReality(); setActiveStep(5); return; }
  if (act==="backToActions"){ setActiveStep(4); return; }

  if (act==="toggleAction"){
    const id = el.getAttribute("data-id");
    if (!id) return;
    if (state.selected.has(id)) state.selected.delete(id); else state.selected.add(id);
    renderActions();
    if (state.step===5) renderReality();
    return;
  }

  if (act==="openLead"){ openSheet("lead"); return; }

  if (act==="openAssumptions"){ openSheet("assumptions"); return; }

  if (act==="toNewResult"){
    // compute updated stop age using selected actions
    renderActions(); // ensures visibleActions computed and selection valid
    const extra = selectedExtraMonthly();
    const newStop = solveStopAge(state.age, state.fpAge, state.savings, state.monthly + extra, state.income);
    state.newStop = newStop;
    renderNewResult();
    setActiveStep(5);
    return;
  }

  if (act==="openWhatItTakes"){ openSheet("whatItTakes"); return; }

  if (act==="restart"){
    // reset state and inputs (no hidden persistence)
    state.step = 0;
    state.age = null; state.fpAge=null; state.savings=null; state.monthly=null; state.income=null;
    state.baseStop=null; state.newStop=null;
    state.selected = new Set();
    state.visibleActions = [];
    ["ageInput","savInput","invInput","incInput"].forEach(id=>{ const inp = document.getElementById(id); if (inp) inp.value=""; });
    // close any sheets
    closeSheet();
    // reset hint boxes
    document.querySelectorAll(".hint.open").forEach(x=>x.classList.remove("open"));
    setActiveStep(0);
    return;
  }


  if (act==="closeSheet"){ closeSheet(); return; }

  if (act==="sendLead"){
    const name = ($("leadName")?.value || "").trim();
    const email = ($("leadEmail")?.value || "").trim();
    const phone = ($("leadPhone")?.value || "").trim();
    const consent = !!$("leadConsent")?.checked;
    const err = $("leadErr");
    const ok = consent && name.length>=2 && (email.includes("@") || phone.replace(/\D/g,"").length>=8);
    if (!ok){
      if (err) err.style.display="block";
      return;
    }
    if (err) err.style.display="none";
    // Demo mode: no endpoint. Provide clear UX.
    $("sheetBody").innerHTML = `
      <div class="p" style="font-size:15px;">Tak. Din kontakt er klar til at blive sendt, når der er sat en mail/endpoint op.</div>
      <div class="small">Indtil da gemmes den ikke. (Ingen skjult tracking.)</div>
      <div class="hr"></div>
      <button class="cta" data-action="closeSheet" type="button">Luk</button>
    `;
    return;
  }
});

// sheet backdrop close + esc
$("backdrop").addEventListener("click", closeSheet, {passive:true});
document.addEventListener("keydown", (e)=>{ if (e.key==="Escape") closeSheet(); });


// live update fp age on age input
$("ageInput").addEventListener("input", ()=>{
  const n = parseMoney($("ageInput").value);
  state.age = isFinite(n)? Math.round(n) : null;
  updateFpAge();
}, {passive:true});


document.addEventListener("keydown", (e)=>{
  if (e.key!=="Enter" && e.key!==" ") return;
  const el = e.target.closest("[data-action]");
  if (!el) return;
  const act = el.getAttribute("data-action");
  if (act==="openAssumptions" || act==="openWhatItTakes"){
    e.preventDefault();
    el.click();
  }
});

// init
setActiveStep(0);
</script>
</body>
</html>
