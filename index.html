<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Tidsl√∏ft ¬∑ v10.8.1</title>
<style>
:root{
  --bg1:#0b1a2f;
  --bg2:#0f2a48;
  --card: rgba(255,255,255,0.92);
  --card2: rgba(255,255,255,0.96);
  --text:#0b1220;
  --muted: rgba(11,18,32,0.62);
  --blue1:#2b6cff;
  --blue2:#4aa7ff;
  --line: rgba(11,18,32,0.08);
  --radius:22px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Inter,Roboto,Helvetica,Arial,sans-serif;
  color:var(--text);
  background: linear-gradient(160deg,var(--bg1),var(--bg2));
  min-height:100vh;
  line-height:1.55;
}
body::before{
  content:"";
  position:fixed; inset:0;
  background:
    radial-gradient(900px 520px at 20% -10%, rgba(255,255,255,0.09), rgba(255,255,255,0.0) 55%),
    radial-gradient(900px 520px at 80% 0%, rgba(74,167,255,0.10), rgba(255,255,255,0.0) 60%);
  pointer-events:none;
  z-index:-1;
}
.wrap{
  max-width:820px;
  margin:0 auto;
  padding:18px 14px 96px;
}
/* Top progress */
#topBar{
  position:sticky; top:0;
  z-index:30;
  padding:14px 4px 10px;
  background: linear-gradient(180deg, rgba(11,26,47,0.96), rgba(11,26,47,0.72));
  backdrop-filter: blur(10px);
  border-bottom:1px solid rgba(255,255,255,0.06);
}
.topRow{
  display:flex; align-items:center; justify-content:space-between;
  color:rgba(255,255,255,0.92);
  padding:2px 6px 10px;
  font-weight:700;
  letter-spacing:0.02em;
}
#topStep{font-size:14px}
.progress{
  height:4px; border-radius:4px;
  background:rgba(255,255,255,0.16);
  overflow:hidden;
  margin:0 6px 4px;
}
#progressFill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg,var(--blue1),var(--blue2));
  border-radius:4px;
  transition:width .25s ease;
}
/* Cards */
.card{
  background: var(--card);
  border:1px solid rgba(255,255,255,0.35);
  backdrop-filter: blur(8px);
  border-radius: var(--radius);
  box-shadow: 0 18px 40px rgba(0,0,0,0.18);
}
.hero{
  padding:30px 22px;
}
.huge{
  font-size:42px;
  font-weight:900;
  letter-spacing:-0.02em;
  margin:0 0 12px 0;
}
.p{
  margin:0;
  font-size:18px;
  color: rgba(11,18,32,0.70);
}
.small{
  font-size:12px;
  color: rgba(11,18,32,0.55);
}
.hr{height:1px; background:var(--line); margin:18px 0;}
.cta{
  width:100%;
  border:0;
  padding:16px 18px;
  border-radius: 28px;
  font-weight:800;
  font-size:16px;
  color:white;
  background: linear-gradient(90deg,var(--blue1),var(--blue2));
  box-shadow: 0 14px 30px rgba(43,108,255,0.28);
  cursor:pointer;
}
.cta:active{transform: translateY(1px);}
.btnGhost{
  width:100%;
  border:1px solid rgba(11,18,32,0.10);
  padding:14px 16px;
  border-radius: 26px;
  background: rgba(255,255,255,0.80);
  font-weight:700;
  cursor:pointer;
}
.section{display:none; margin-top:18px;}
.section.active{display:block;}
.formCard{padding:20px 18px;}
.kicker{
  font-size:12px;
  letter-spacing:0.18em;
  color: rgba(11,18,32,0.45);
  font-weight:800;
  text-transform:uppercase;
}
.h1{
  font-size:44px; margin:8px 0 8px; font-weight:950; letter-spacing:-0.03em;
}
.helpRow{
  display:flex; align-items:center; justify-content:space-between;
  gap:10px;
}
.label{
  font-size:16px; font-weight:900; margin:18px 0 8px;
}
.input{
  width:100%;
  padding:18px 16px;
  border-radius:18px;
  border:1px solid rgba(11,18,32,0.10);
  font-size:30px;
  font-weight:900;
  outline:none;
  background: rgba(255,255,255,0.98);
}
.input::placeholder{color: rgba(11,18,32,0.28); font-weight:800;}
.hint{
  margin-top:8px;
  padding:12px 14px;
  border-radius:14px;
  background: rgba(43,108,255,0.08);
  border:1px solid rgba(43,108,255,0.14);
  color: rgba(11,18,32,0.75);
  font-size:14px;
  display:none;
}
.hint.open{display:block;}
.iconBtn{
  width:34px; height:34px;
  border-radius:999px;
  border:1px solid rgba(11,18,32,0.10);
  background: rgba(255,255,255,0.85);
  display:flex; align-items:center; justify-content:center;
  font-weight:1000;
  cursor:pointer;
  color: rgba(11,18,32,0.70);
}
/* Result */
.resultWrap{padding:18px 18px;}
.metaPills{
  display:flex; gap:10px; flex-wrap:wrap;
  margin-top:8px;
}
.pill{
  padding:10px 12px;
  border-radius:999px;
  background: rgba(43,108,255,0.10);
  border:1px solid rgba(43,108,255,0.16);
  font-weight:800;
  font-size:13px;
}
.bigNum{
  font-size:64px;
  font-weight:1000;
  letter-spacing:-0.05em;
  margin:12px 0 6px;
}
.center{text-align:center;}
/* Actions */
.actionsHeader{
  display:flex; align-items:flex-end; justify-content:space-between;
  gap:12px;
}
.sumBox{
  margin-top:14px;
  padding:14px 14px;
  border-radius:18px;
  background: rgba(255,255,255,0.92);
  border:1px solid rgba(11,18,32,0.08);
}
.sumBox .t{font-weight:950;}
.sumBox .r{float:right; font-weight:950; color: rgba(43,108,255,0.90);}
.actionList{margin-top:12px; display:flex; flex-direction:column; gap:12px;}
.actionCard{
  padding:14px 14px;
  border-radius:18px;
  border:1px solid rgba(11,18,32,0.08);
  background: rgba(255,255,255,0.92);
  display:flex; justify-content:space-between; gap:12px;
  cursor:pointer;
}
.actionCard.selected{
  border-color: rgba(43,108,255,0.45);
  box-shadow: 0 10px 22px rgba(43,108,255,0.18);
}
.actionLeft{
  display:flex; gap:10px;
}
.badge{
  display:inline-flex;
  padding:6px 10px;
  border-radius:999px;
  border:1px solid rgba(11,18,32,0.10);
  font-size:12px;
  font-weight:850;
  color: rgba(11,18,32,0.62);
  margin-top:8px;
}
.actionTitle{font-weight:950; font-size:16px;}
.actionSub{font-size:12px; color: rgba(11,18,32,0.55); margin-top:2px;}
.actionRight{
  text-align:right;
  min-width:92px;
}
.effect{
  font-weight:950; color: rgba(43,108,255,0.90);
}
.kr{
  font-weight:900; color: rgba(11,18,32,0.70);
}
/* Assumptions footer link (inline, never overlaps) */
.assumpFooter{
  margin-top:18px;
  padding-top:14px;
  border-top:1px solid rgba(11,18,32,0.08);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  font-size:13px;
  color: rgba(11,18,32,0.55);
  cursor:pointer;
  user-select:none;
}
.assumpFooter .i{
  width:22px; height:22px;
  border-radius:999px;
  display:flex; align-items:center; justify-content:center;
  border:1px solid rgba(11,18,32,0.12);
  background: rgba(255,255,255,0.8);
  font-weight:950;
  color: rgba(11,18,32,0.65);
}
.assumpFooter:hover{ color: rgba(11,18,32,0.72); }

/* Modal / sheet */

.backdrop{
  position:fixed; inset:0;
  background: rgba(0,0,0,0.42);
  display:none;
  z-index:80;
}
.backdrop.open{display:block;}
.sheet{
  position:fixed;
  left:0; right:0; bottom:-100%;
  z-index:90;
  transition: bottom .25s ease;
  padding:0 10px 10px;
}
.sheet.open{bottom:0;}
.sheetCard{
  max-width:820px;
  margin:0 auto;
  background: rgba(255,255,255,0.96);
  border:1px solid rgba(11,18,32,0.10);
  border-radius: 22px;
  box-shadow: 0 26px 60px rgba(0,0,0,0.25);
  overflow:hidden;
}
.sheetHead{
  padding:14px 16px;
  display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
  border-bottom:1px solid rgba(11,18,32,0.08);
}
.sheetTitle{font-weight:950; font-size:18px;}
.closeX{
  border:1px solid rgba(11,18,32,0.12);
  background: rgba(255,255,255,0.90);
  border-radius:12px;
  padding:8px 10px;
  font-weight:950;
  cursor:pointer;
}
.sheetBody{
  max-height:62vh;
  overflow:auto;
  padding:14px 16px 18px;
}
.sheetBody h4{margin:14px 0 8px;}
.sheetBody ul{margin:8px 0 0 18px;}
.mono{font-variant-numeric: tabular-nums; font-feature-settings:"tnum" 1; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}


.sheetCard.highlight.sticky{position:sticky;top:0;z-index:4;}
.sheetCard.highlight.sticky .bigNumber{font-size:44px;}
.pillRow{gap:6px;}
.pill{padding:7px 10px;font-size:13px;}
/* Sheet controls (what-it-takes) */
.rangeRow{display:flex;gap:12px;align-items:center;margin-top:10px}
.ageInputSmall{width:86px;flex:0 0 auto;border:1px solid rgba(11,18,32,.10);border-radius:14px;padding:12px 12px;font-weight:800;font-size:18px;background:rgba(255,255,255,.92)}
.pillRow{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.pill{display:inline-flex;align-items:center;gap:6px;padding:10px 12px;border-radius:999px;background:rgba(43,108,255,.10);border:1px solid rgba(43,108,255,.16);color:rgba(11,18,32,.88);font-size:14px}
.rangeInput{-webkit-appearance:none;appearance:none;width:100%;height:8px;border-radius:999px;background:linear-gradient(90deg,var(--blue1) var(--p,50%), rgba(11,18,32,.14) var(--p,50%));outline:none}
.rangeInput::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:26px;height:26px;border-radius:50%;background:#fff;border:4px solid var(--blue1);box-shadow:0 10px 24px rgba(11,18,32,.18)}
.rangeInput::-moz-range-thumb{width:26px;height:26px;border-radius:50%;background:#fff;border:4px solid var(--blue1);box-shadow:0 10px 24px rgba(11,18,32,.18)}
.rangeInput::-moz-range-track{height:8px;border-radius:999px;background:rgba(11,18,32,.14)}
.sheetLead{color:rgba(11,18,32,.68);line-height:1.5;margin:0 0 14px}
.sheetCard{background:rgba(255,255,255,.95);border:1px solid rgba(11,18,32,.06);border-radius:18px;padding:14px 14px;box-shadow:0 14px 40px rgba(11,18,32,.10);margin:0 0 12px}
.sheetCard.highlight{border-color:rgba(43,108,255,.18)}
.sheetRow{display:flex;justify-content:space-between;align-items:baseline;gap:10px}
.sheetLabel{font-weight:900}
.sheetHint{color:rgba(11,18,32,.55);font-size:13px}
.bigNumber{font-size:40px;font-weight:950;letter-spacing:-0.02em;margin-top:10px}
.bigNumber .unit{font-size:16px;font-weight:800;color:rgba(11,18,32,.60);margin-left:6px}
.finePrint{margin-top:8px;color:rgba(11,18,32,.60);font-size:13px;line-height:1.45}

/* Footer button row */
.row{
  display:flex; gap:12px; margin-top:18px;
}
.row .btnGhost{flex:1}
.row .cta{flex:2}
/* Hide top bar on intro */
body.intro #topBar{display:none;}

/* Range (slider) fill that respects min/max (set via --pct from JS) */
input[type="range"]{
  -webkit-appearance:none;
  appearance:none;
  height: 6px;
  border-radius: 999px;
  outline:none;
  background: linear-gradient(90deg, rgba(43,108,255,0.95) 0%, rgba(74,167,255,0.95) calc(var(--pct, 0) * 100%), rgba(11,18,32,0.12) calc(var(--pct, 0) * 100%), rgba(11,18,32,0.12) 100%);
}
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none;
  appearance:none;
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: white;
  border: 3px solid rgba(43,108,255,0.95);
  box-shadow: 0 6px 20px rgba(11,18,32,0.18);
}
input[type="range"]::-moz-range-thumb{
  width: 22px;
  height: 22px;
  border-radius: 999px;
  background: white;
  border: 3px solid rgba(43,108,255,0.95);
  box-shadow: 0 6px 20px rgba(11,18,32,0.18);
}
input[type="range"]::-moz-range-track{
  height: 6px;
  border-radius: 999px;
  background: transparent;
}


/* v10.7.0: input gating + mobile-first compact steps 4-5 */
.disabled{opacity:0.55; pointer-events:none; filter:saturate(0.85);}
.errBox{
  display:none;
  margin: 0 0 12px;
  padding: 12px 12px;
  border-radius: 14px;
  border: 1px solid rgba(220,38,38,0.18);
  background: rgba(220,38,38,0.06);
  color: rgba(153,27,27,0.95);
  font-weight: 850;
  font-size: 14px;
}

/* Compact the ‚Äúabove the fold‚Äù on mobile */
@media (max-width: 430px){
  #s_actions .h1{font-size:32px !important; line-height:1.05;}
  #s_newresult .h1{font-size:32px !important; line-height:1.05;}
  .card.formCard{padding:18px !important;}
  .card.resultWrap{padding:18px !important;}
  #s_actions .p{font-size:15px !important;}
  #s_newresult .p{font-size:15px !important;}
  #s_actions .sumBox{padding:12px 12px !important; margin-top:10px !important;}
  #s_actions .sumBox{position:sticky; top:64px; z-index:20; backdrop-filter: blur(8px);}
  #s_actions .actionList{margin-top:12px !important;}
  #s_actions .row{gap:10px !important;}
  #s_actions .btnGhost, #s_actions .cta{height:52px !important;}
  #s_newresult .metaPills{gap:8px !important;}
  #s_newresult .pill{font-size:13px !important; padding:10px 10px !important;}
  #s_newresult .bigNum{font-size:58px !important;}
}

</style>
</head>
<body class="intro">
  <div id="topBar">
    <div class="topRow">
      <div id="topStep">TRIN 1 / 5</div>
      <div style="opacity:.0">.</div>
    </div>
    <div class="progress"><div id="progressFill"></div></div>
  </div>

  <div class="wrap">
    <!-- INTRO -->
    <section class="section active" data-step="0" id="s_intro">
      <div class="card hero">
        <div class="huge">Skab tidligere frihed.</div>
        <p class="p">Se hvorn√•r det realistisk kan lade sig g√∏re ‚Äì baseret p√• dine tal.</p>
        <div style="height:18px"></div>
        <button class="cta" data-action="start">Start beregningen</button>
        <div class="small" style="margin-top:10px;">Ingen tilmelding. Tager under 3 minutter.</div>

        <div class="hr"></div>

        <div class="p" style="font-size:16px; margin:0;">Du indtaster tre tal. Vi beregner √©t konkret stop-tidspunkt og viser, hvad din plan eventuelt kr√¶ver.</div>
        <div style="margin-top:14px; line-height:1.75; font-weight:900;">
          ‚úî Konkrete tal ‚Äì ikke prognoser<br/>
          ‚úî Konservative foruds√¶tninger<br/>
          ‚úî √ât realistisk stop-tidspunkt
        </div>

        <div class="small" style="margin-top:16px;">Vejledende beregning. Skat og individuelle pensionsordninger indg√•r ikke.</div>
      </div>
    </section>

    <!-- STEP 1 AGE -->
    <section class="section" data-step="1" id="s_age">
      <div class="card formCard">
        <div class="kicker">TRIN 1/5</div>
        <div class="h1">Din alder</div>
        <div class="p" style="font-size:16px;">Vi estimerer din folkepensionsalder ud fra din alder.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Alder</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintAge" aria-label="Hj√¶lp">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" maxlength="3" id="ageInput" placeholder="fx 46"/>
        <div class="hint" id="hintAge">Indtast din alder i hele √•r.</div>

        <div style="height:12px"></div>
        <div class="card" style="padding:14px 14px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div class="kicker" style="letter-spacing:0.12em;">FOLKEPENSION (ESTIMAT)</div>
          <div style="display:flex; align-items:baseline; justify-content:space-between; gap:10px;">
            <div class="bigNum mono" style="font-size:54px; margin:8px 0 0;" id="fpAgeBig">‚Äî</div>
            <div class="small" style="font-size:14px; font-weight:800;">√•r</div>
          </div>
        </div>

        <div style="height:16px"></div>
        <button class="cta" data-action="next">Forts√¶t</button>
      
        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Foruds√¶tninger og beregningsmodel">
          <div class="i">i</div>
          <div>Foruds√¶tninger &amp; beregningsmodel</div>
        </div>
</div>
    </section>

    <!-- STEP 2 NUMBERS -->
    <section class="section" data-step="2" id="s_numbers">
      <div class="card formCard">
        <div class="kicker">TRIN 2/5</div>
        <div class="h1">Dine tal</div>
        <div class="p" style="font-size:16px;">Felterne har kun forslag (ikke forudfyldte v√¶rdier). Du kan altid justere senere.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">Opsparing i dag (kr.)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintSav">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="savInput" placeholder="fx 25.000"/>
        <div class="hint" id="hintSav">Din opsparing/investerede formue i dag (ikke pensioner).</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">M√•nedlig investering (kr./md)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintInv">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="invInput" placeholder="fx 3.500"/>
        <div class="hint" id="hintInv">Det bel√∏b du realistisk kan investere hver m√•ned frem til stop. Brug et bel√∏b du kan holde over tid.</div>

        <div class="helpRow" style="margin-top:18px;">
          <div class="label" style="margin:0;">√ònsket m√•nedlig indkomst f√∏r folkepension (kr./md)</div>
          <button class="iconBtn" data-action="toggleHint" data-hint="hintInc">?</button>
        </div>
        <input class="input" inputmode="numeric" pattern="[0-9]*" id="incInput" placeholder="fx 35.000"/>
        <div class="hint" id="hintInc">Angiv bruttobel√∏b. Vi regner uden skat for gennemsigtighed.</div>

        <div style="height:16px"></div>
        <div id="numbersErr" class="errBox"></div>
        <button class="cta disabled" data-action="compute" id="computeBtn">Se resultat</button>
      
        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Foruds√¶tninger og beregningsmodel">
          <div class="i">i</div>
          <div>Foruds√¶tninger &amp; beregningsmodel</div>
        </div>
</div>
    </section>

    <!-- STEP 3 RESULT -->
    <section class="section" data-step="3" id="s_result">
      <div class="card resultWrap">
        <div class="kicker">TRIN 3/5</div>
        <div class="h1">Dit potentiale</div>
        <div class="p" style="font-size:16px;">Baseret p√• dine tal lige nu. Sm√• √¶ndringer kan give ekstra frihed.</div>

        <div class="metaPills">
          <div class="pill">Din alder: <span class="mono" id="curAgeLbl">‚Äî</span></div>
          <div class="pill">Folkepension: <span class="mono" id="fpAgeLbl">‚Äî</span></div>
        </div>

        <div class="center">
          <div class="bigNum mono" id="stopAgeLbl">‚Äî</div>
          <div style="font-weight:900; font-size:18px;">din mulige stop-alder</div>
          <div class="p" style="font-size:15px; margin-top:6px;" id="stopSub">‚Äî</div>
        </div>

        <div class="hr"></div>

        <div class="row">
          <button class="btnGhost" data-action="backToNumbers">Tilbage</button>
          <button class="cta" data-action="toActions">Forbedr min plan</button>
        </div>

        <div style="height:12px"></div>
        <button class="btnGhost" data-action="openLead">√ònsker du sparring? F√• kontakt til r√•dgiver</button>
      
        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Foruds√¶tninger og beregningsmodel">
          <div class="i">i</div>
          <div>Foruds√¶tninger &amp; beregningsmodel</div>
        </div>
</div>
    </section>

    <!-- STEP 4 ACTIONS -->
    <section class="section" data-step="4" id="s_actions">
      <div class="card formCard">
        <div class="kicker">TRIN 4/5</div>
        <div class="h1" style="font-size:40px;">Sm√• √¶ndringer</div>
        <div class="p" style="font-size:16px;">V√¶lg konkrete greb. Vi viser kun forslag med mindst 1 m√•ned effekt.</div>

        <div class="sumBox">
          <div><span class="t">Samlet frihedsl√∏ft</span> <span class="r" id="sumLift">+0 md</span></div>
          <div class="small" style="margin-top:4px;">Effekten vises som potentiale, hvis du kan frig√∏re bel√∏bet.</div>
        </div>

        <div class="actionList" id="actionList"></div>

        <div class="hr"></div>
        <div class="row">
          <button class="btnGhost" data-action="backToResult">Tilbage</button>
          <button class="cta" data-action="toNewResult">Se nyt resultat</button>
        </div>

        <div style="height:12px"></div>
        <button class="btnGhost" data-action="openLead">F√• kontakt til r√•dgiver</button>
      
        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Foruds√¶tninger og beregningsmodel">
          <div class="i">i</div>
          <div>Foruds√¶tninger &amp; beregningsmodel</div>
        </div>
</div>
    </section>

    <!-- STEP 5 NEW RESULT -->
    <section class="section" data-step="5" id="s_newresult">
      <div class="card resultWrap">
        <div class="kicker">TRIN 5/5</div>
        <div class="h1">Nyt resultat</div>
        <div class="p" style="font-size:16px;">Med dine valgte √¶ndringer.</div>

        <div class="metaPills">
          <div class="pill">Oprindeligt: <span class="mono" id="baseStopLbl">‚Äî</span> √•r</div>
          <div class="pill">Nyt estimat: <span class="mono" id="newStopLbl">‚Äî</span> √•r</div>
          <div class="pill">L√∏ft: <span class="mono" id="newLiftLbl">‚Äî</span></div>
        </div>

        <div class="center" style="margin-top:10px;">
          <div class="bigNum mono" id="newStopBig">‚Äî</div>
          <div style="font-weight:900; font-size:18px;">din mulige stop-alder</div>
          <div class="p" style="font-size:15px; margin-top:6px;" id="newStopSub">‚Äî</div>
        </div>

        <div class="hr"></div>

        <div class="card" style="padding:16px 16px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div style="font-weight:950; font-size:18px;">Ikke tilfreds?</div>
          <div class="p" style="font-size:15px; margin-top:6px;">Se hvad der realistisk skal til for at stoppe endnu tidligere.</div>
          <div style="height:10px"></div>
          <button class="cta" data-action="openWhatItTakes">Se hvad der skal til</button>
        </div>

        <div style="height:14px"></div>

        <div class="card" style="padding:16px 16px; border-radius:18px; border:1px solid rgba(11,18,32,0.08); background: rgba(255,255,255,0.92);">
          <div style="font-weight:950; font-size:18px;">√ònsker du sparring p√• din plan?</div>
          <div class="p" style="font-size:15px; margin-top:6px;">F√• en uforpligtende gennemgang af dine tal og muligheder med en r√•dgiver.</div>
          <div style="height:10px"></div>
          <button class="cta" data-action="openLead">Book en uforpligtende samtale</button>
          <div class="small" style="margin-top:10px;">Du kontaktes kun hvis du selv sender din foresp√∏rgsel og giver samtykke.</div>
        </div>

        <div class="hr"></div>
        <div class="row">
          <button class="btnGhost" data-action="backToActions">Tilbage</button>
          <button class="btnGhost" data-action="restart">Start forfra</button>
        </div>

        <div class="assumpFooter" data-action="openAssumptions" role="button" tabindex="0" aria-label="Foruds√¶tninger og beregningsmodel">
          <div class="i">i</div>
          <div>Foruds√¶tninger &amp; beregningsmodel</div>
        </div>
      </div>
    </section>
</div>
<div class="i">i</div>
  </div>

  <!-- Backdrop + Sheet -->
  <div class="backdrop" id="backdrop"></div>
  <div class="sheet" id="sheet">
    <div class="sheetCard" role="dialog" aria-modal="true" aria-label="Dialog">
      <div class="sheetHead">
        <div class="sheetTitle" id="sheetTitle">Titel</div>
        <button class="closeX" data-action="closeSheet" type="button">Luk</button>
      </div>
      <div class="sheetBody" id="sheetBody"></div>
    </div>
  </div>

<script>
/* =========================
   v10.7.0 New Motor
   ========================= */

// Model constants (must match UI text)
const REAL_RETURN_ANNUAL = 0.04;   // realafkast pr. √•r (konservativt)
const DISCOUNT_RATE_ANNUAL = 0.02; // diskonteringsrente pr. √•r (konservativ)
const BRIDGE_BUFFER = 0.10;        // sikkerhedsbuffer p√• brobehov

// --- deterministic pension age estimate (cap at 70, as before) ---
function pensionAgeByBirthYearApprox(birthYear){
  if (birthYear <= 1962) return 67;
  if (birthYear <= 1966) return 68;
  if (birthYear <= 1970) return 69;
  return 70; // cap (vedtaget loft)
}
function pensionAgeFromCurrentAgeApprox(currentAge){
  // approx birth year with +/-1 uncertainty to avoid false precision
  const y = new Date().getFullYear();
  const by1 = y - currentAge;
  const by2 = y - currentAge - 1;
  const p1 = pensionAgeByBirthYearApprox(by1);
  const p2 = pensionAgeByBirthYearApprox(by2);
  return Math.min(70, Math.max(p1, p2));
}

// --- math ---
function futureValue(savings, monthly, years, rAnnual=REAL_RETURN_ANNUAL){
  const n = Math.max(0, Math.round(years * 12));
  const r = rAnnual/12;
  let fv = savings * Math.pow(1+r, n);
  if (monthly > 0){
    fv += monthly * ((Math.pow(1+r, n)-1)/r);
  }
  return fv;
}
function bridgePV(annualSpend, years, rAnnual=DISCOUNT_RATE_ANNUAL, buffer=BRIDGE_BUFFER){
  const n = Math.max(0, Math.round(years*12));
  const r = rAnnual/12;
  if (n<=0) return 0;
  const pv = (annualSpend/12) * (1 - Math.pow(1+r, -n)) / r;
  return pv * (1+buffer);
}
function solveStopAge(age, pensionAge, savings, monthlyTotal, income){
  // income is desired monthly before pension
  let best = NaN;
  for (let a = age; a <= pensionAge; a += 0.5){
    const t = a - age;
    const fv = futureValue(savings, monthlyTotal, t);
    const bridgeYears = Math.max(0, pensionAge - a);
    const need = bridgePV(income*12, bridgeYears);
    if (fv >= need){ best = a; break; }
  }
  if (Number.isNaN(best)) best = pensionAge;
  return best;
}
function extraMonthlyNeededForGoal(age, goalAge, pensionAge, savings, monthlyBase, income){
  goalAge = Math.min(goalAge, pensionAge);
  const t = Math.max(0, goalAge - age);
  const fvBase = futureValue(savings, monthlyBase, t);
  const need = bridgePV(income*12, Math.max(0, pensionAge - goalAge));
  const gap = Math.max(0, need - fvBase);
  if (gap <= 0) return 0;
  const n = Math.max(1, Math.round(t*12));
  const r = REAL_RETURN_ANNUAL/12;
  const factor = (Math.pow(1+r, n)-1)/r; // FV of 1 kr/month
  const m = gap / factor;
  return Math.ceil(m/50)*50; // round to 50 kr
}
function fmtInt(n){
  if (!isFinite(n)) return "‚Äî";
  return Math.round(n).toLocaleString("da-DK");
}

function updateRangeFill(el){
  if (!el) return;
  const min = Number(el.min);
  const max = Number(el.max);
  const val = Number(el.value);
  const denom = (max - min);
  let pct = 0;
  if (isFinite(denom) && denom > 0 && isFinite(val)){
    pct = (val - min) / denom;
  }
  if (!isFinite(pct)) pct = 0;
  pct = Math.max(0, Math.min(1, pct));
  el.style.setProperty("--pct", String(pct));
}

function yearsToMonths(y){ return Math.round(y*12); }

// --- actions library (concrete items) ---
const ACTIONS = [
  {id:"car_less", title:"√ân bil mindre i husstanden", monthly:2500, tag:"St√∏rre greb"},
  {id:"insurance", title:"Gennemg√• forsikringer", monthly:300, tag:"Konkrete greb"},
  {id:"groceries", title:"Strammere dagligvarebudget", monthly:500, tag:"Konkrete greb"},
  {id:"subscriptions", title:"Fjern abonnementer du ikke bruger", monthly:250, tag:"Konkrete greb"},
  {id:"vacation", title:"F√¶rre/enkle ferier (snit pr. md)", monthly:700, tag:"Konkrete greb"},
  {id:"transport", title:"Mindre benzin/transport (snit pr. md)", monthly:400, tag:"Konkrete greb"},
  {id:"takeaway", title:"Mindre takeaway/caf√©", monthly:400, tag:"Konkrete greb"},
  {id:"housing", title:"Lavere boligudgifter (snit pr. md)", monthly:1000, tag:"St√∏rre greb"},
];

// --- state ---
const state = {
  step: 0,
  age: null,
  fpAge: null,
  savings: null,
  monthly: null,
  income: null,
  baseStop: null,
  selected: new Set(),
  visibleActions: [],
  newStop: null,
};

// --- DOM helpers ---
const $ = (id)=>document.getElementById(id);
function setActiveStep(step){
  state.step = step;
  document.body.classList.toggle("intro", step===0);
  document.querySelectorAll(".section").forEach(sec=>{
    const s = Number(sec.getAttribute("data-step"));
    sec.classList.toggle("active", s===step);
  });
  // top bar
  const top = $("topBar");
  if (top) top.style.display = step===0 ? "none":"block";
  if (step>0){
    $("topStep").textContent = `TRIN ${step} / 5`;
    $("progressFill").style.width = `${Math.round((step/5)*100)}%`;
  }
  if (chip) chip.style.display = step===0 ? "none":"flex";
  // On mobile Safari the previous scroll position can be preserved between steps.
  // Force the viewport to the top of the newly activated section.
  requestAnimationFrame(()=>{
    const active = document.querySelector('.section.active');
    if(active) active.scrollIntoView({block:'start', behavior:'auto'});
    window.scrollTo({top:0, left:0, behavior:'auto'});
  });
}

function fmtMonths(m){
  const mm = Math.max(0, Math.round(Number(m)||0));
  const y = Math.floor(mm/12);
  const r = mm % 12;
  if (y <= 0) return `${r} md`;
  if (r === 0) return `${y} √•r`;
  return `${y} √•r ${r} md`;
}
function fmtDeltaMonths(m){
  const mm = Math.max(0, Math.round(Number(m)||0));
  return `+${fmtMonths(mm)}`;
}
function parseMoney(v){
  if (typeof v !== "string") return NaN;
  const clean = v.replace(/\./g,"").replace(/,/g,"").replace(/\s/g,"");
  const n = Number(clean);
  return isFinite(n) ? n : NaN;
}

function moneyOrNull(raw){
  const s = String(raw ?? "").trim();
  if (!s) return null;
  const n = parseMoney(s);
  if (!isFinite(n)) return null;
  return n;
}


// --- sheet manager ---
let sheetMode = null; // "assumptions" | "lead" | "whatItTakes"
function openSheet(mode){
  sheetMode = mode;
  const back = $("backdrop"), sh = $("sheet");
  if (back) back.classList.add("open");
  if (sh) sh.classList.add("open");
  // Lock background scroll (prevents iOS jump when focusing inside the sheet)
  const y = window.scrollY || 0;
  document.body.dataset.scrollY = String(y);
  document.body.style.position = 'fixed';
  document.body.style.top = `-${y}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';
  const body = $("sheetBody");
  if (body) body.scrollTop = 0;
  renderSheet();
}
function closeSheet(){
  const back = $("backdrop"), sh = $("sheet");
  if (back) back.classList.remove("open");
  if (sh) sh.classList.remove("open");
  sheetMode = null;
  const y = parseInt(document.body.dataset.scrollY||'0',10) || 0;
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.left = '';
  document.body.style.right = '';
  window.scrollTo(0, y);
}
function renderSheet(){
  const title = $("sheetTitle"), body = $("sheetBody");
  if (!title || !body) return;
  if (sheetMode === "assumptions"){
    title.textContent = "Foruds√¶tninger & beregningsmodel";
    body.innerHTML = `
      <div class="small">Form√•l: give et gennemsigtigt overblik. Resultatet er et <strong>estimat</strong> ‚Äì ikke personlig r√•dgivning.</div>
      <div class="hr"></div>

      <h4>Hvad beregningen viser</h4>
      <div class="p" style="font-size:15px;">Et vejledende stop-tidspunkt: hvorn√•r din opsparing (start + l√∏bende indbetaling) realistisk kan finansiere dit √∏nskede m√•nedlige bel√∏b frem til folkepensionsalderen.</div>

      <h4>Afkast/rente og inflation</h4>
      <ul>
        <li><strong>Realafkast</strong> (efter inflation): <span class="mono">${(REAL_RETURN_ANNUAL*100).toFixed(1)}%</span> pr. √•r (konservativt), med m√•nedlig forrentning.</li>
        <li><strong>Diskontering</strong> af brobehov: <span class="mono">${(DISCOUNT_RATE_ANNUAL*100).toFixed(1)}%</span> pr. √•r.</li>
        <li><strong>Sikkerhedsbuffer</strong> p√• brobehov: <span class="mono">${Math.round(BRIDGE_BUFFER*100)}%</span>.</li>
        <li>Bel√∏b forst√•s som ‚Äúnutidskroner‚Äù, fordi vi bruger realafkast.</li>
      </ul>

      <h4>Hvad der ikke indg√•r</h4>
      <ul>
        <li><strong>Skat</strong> indg√•r ikke.</li>
        <li><strong>Individuelle pensionsordninger</strong> (arbejdsmarkedspension, ATP, private pensioner) er ikke medregnet.</li>
      </ul>

      <h4>Folkepension og loft</h4>
      <ul>
        <li>Folkepensionsalderen estimeres ud fra alder og f√∏lger <strong>vedtaget loft</strong> (vi g√¶tter ikke p√• fremtidige politiske √¶ndringer).</li>
        <li>Der kan v√¶re mindre afvigelse ift. pr√¶cis f√∏dselsdato.</li>
      </ul>

      <h4>Usikkerhed</h4>
      <div class="p" style="font-size:15px;">Resultatet afh√¶nger is√¶r af afkast, stabilitet i indbetalinger og om dit m√•lbel√∏b √¶ndrer sig over tid.</div>
    `;
    return;
  }
  if (sheetMode === "lead"){
    title.textContent = "Formidl kontakt til r√•dgiver";
    body.innerHTML = `
      <div class="p" style="font-size:15px;">Du bliver kun kontaktet, hvis du giver samtykke og sender formularen.</div>
      <div class="hr"></div>

      <div class="kicker" style="margin-bottom:6px;">KONTAKT</div>
      <div class="label" style="margin:0 0 8px;">Navn</div>
      <input class="input" id="leadName" placeholder="Dit navn" style="font-size:22px; padding:14px 14px;"/>

      <div class="label" style="margin:14px 0 8px;">E-mail</div>
      <input class="input" id="leadEmail" placeholder="navn@eksempel.dk" style="font-size:22px; padding:14px 14px;"/>

      <div class="label" style="margin:14px 0 8px;">Telefon</div>
      <input class="input" id="leadPhone" placeholder="+45 ..." style="font-size:22px; padding:14px 14px;"/>

      <div style="display:flex; gap:10px; align-items:flex-start; margin-top:14px;">
        <input type="checkbox" id="leadConsent" style="margin-top:3px;"/>
        <label for="leadConsent" class="p" style="font-size:14px; margin:0; color: rgba(11,18,32,0.70);">
          Jeg √∏nsker at blive kontaktet af en r√•dgiver vedr√∏rende mine beregninger. Oplysninger bruges kun til dette form√•l.
        </label>
      </div>
      <div class="small" id="leadErr" style="margin-top:8px; color: rgba(180,35,35,0.9); display:none;">Udfyld kontakt og giv samtykke for at sende.</div>

      <div class="hr"></div>
      <div class="row">
        <button class="btnGhost" data-action="closeSheet" type="button">Annull√©r</button>
        <button class="cta" data-action="sendLead" type="button">Send kontakt</button>
      </div>
      <div class="small" style="margin-top:10px;">Privatliv og samtykke</div>
    `;
    return;
  }

  
if (sheetMode === "whatItTakes"){
  // Goal (always earlier than current estimate)
  const stopAgeAdj = state.stopAgeAdj;
  const nowAge = state.age || 0;
  const fpAge  = state.fpAge || 0;

  // Range: up to 12 years earlier than current estimate (clamped by current age)
  const maxExtraYears = 12;
  const minGoal = clampInt(stopAgeAdj - maxExtraYears, nowAge + 1, stopAgeAdj - 1);
  const maxGoal = stopAgeAdj - 1;

  // Keep previous selection if any
  const goal = clampInt(state.goalAge || Math.min(maxGoal, fpAge), minGoal, maxGoal);
  state.goalAge = goal;

  // Very simple "what it takes" model (same assumptions as baseline)
  // We show additional monthly investing needed to fund target spend until folkepension.
  const monthsToFp = Math.max(1, (fpAge - goal) * 12);
  const needMonthly = Math.max(0, Math.round(((state.targetSpend || 0) * 12) / monthsToFp));
  const extraBase = Math.max(0, needMonthly - (state.monthly || 0) - (state.selectedExtraMonthly || 0));

  // Never show "0" as a false precision; show "< 100" if very low
  const extraLabel = extraBase < 100 ? "< 100" : fmt(extraBase);

  const pct = (maxGoal === minGoal) ? 100 : Math.round(((goal - minGoal) / (maxGoal - minGoal)) * 100);

  sheetTitle.textContent = "Hvad skal der til?";
  sheetBody.innerHTML = `

    <div class="sheetCard highlight sticky">
      <div class="sheetRow">
        <div class="sheetLabel">Ekstra m√•nedlig investering</div>

    <div class="sheetLead">
      V√¶lg en tidligere stop-alder. Vi estimerer et ekstra m√•nedligt bel√∏b, der kan g√∏re m√•let realistisk.
    </div>

    <div class="sheetCard">
      <div class="sheetRow">
        <div class="sheetLabel">√ònsket stop-alder</div>
        <div class="sheetHint">Interval: ${minGoal}‚Äì${maxGoal} √•r</div>
      </div>

      <div class="rangeRow">
        <input id="goalInput2" class="ageInputSmall" type="number" inputmode="numeric" min="${minGoal}" max="${maxGoal}" value="${goal}" />
        <input id="goalSlider2" class="rangeInput" type="range" min="${minGoal}" max="${maxGoal}" value="${goal}" style="--p:${pct}%"/>
      </div>

      <div class="pillRow">
        <span class="pill">√ònske <b>${goal} √•r</b></span>
        <span class="pill">Nuv√¶rende <b>${stopAgeAdj} √•r</b></span>
        <span class="pill">Folkepension <b>${fpAge}</b></span>
      </div>
    </div>        <div class="sheetHint">estimat</div>
      </div>
      <div class="bigNumber">${extraLabel} <span class="unit">kr./md</span></div>
      <div class="finePrint">Beregnet med samme foruds√¶tninger som resultatet. Inkluderer dine valgte greb (+${fmt(state.selectedExtraMonthly||0)} kr./md).</div>
    </div>
  `;

  const slider = $("#goalSlider2");
  const input  = $("#goalInput2");

  const sync = (v)=>{
    const val = clampInt(parseInt(v||goal,10), minGoal, maxGoal);
    state.goalAge = val;
    const p = (maxGoal === minGoal) ? 100 : Math.round(((val - minGoal) / (maxGoal - minGoal)) * 100);
    slider.style.setProperty("--p", p + "%");
  };

  slider.addEventListener("input", ()=>{ sync(slider.value); renderSheet(); });
  input.addEventListener("input",  ()=>{ sync(input.value); slider.value = state.goalAge; renderSheet(); });

  return;
}
// --- core computations + rendering ---
function updateFpAge(){
  if (!isFinite(state.age)) { state.fpAge = null; $("fpAgeBig").textContent="‚Äî"; return; }
  state.fpAge = pensionAgeFromCurrentAgeApprox(state.age);
  $("fpAgeBig").textContent = String(state.fpAge);
}

(function bindAgeLive(){
  const el = document.getElementById("ageInput");
  if (!el) return;
  const run = ()=>{
    const n = parseMoney(el.value);
    if (isFinite(n) && n>=16 && n<=100){
      state.age = Math.round(n);
      updateFpAge();
    } else {
      state.age = null;
      state.fpAge = null;
      const out = document.getElementById("fpAgeBig");
      if (out) out.textContent = "‚Äî";
    }
  };
  ["input","change","keyup"].forEach(evt=> el.addEventListener(evt, run, {passive:true}));
  requestAnimationFrame(run);
})();

function computeBase(){
  const a = state.age;
  const fp = state.fpAge;
  const s = state.savings;
  const m = state.monthly;
  const inc = state.income;
  if (![a,fp,s,m,inc].every(x=>isFinite(x))) return false;
  const stop = solveStopAge(a, fp, s, m, inc);
  state.baseStop = stop;
  return true;
}
function renderResult(){
  $("curAgeLbl").textContent = state.age ?? "‚Äî";
  $("fpAgeLbl").textContent = state.fpAge ?? "‚Äî";
  $("stopAgeLbl").textContent = isFinite(state.baseStop) ? Math.round(state.baseStop) : "‚Äî";
  if (isFinite(state.baseStop) && isFinite(state.fpAge)){
    const diff = Math.max(0, state.fpAge - state.baseStop);
    $("stopSub").textContent = `Det svarer til ca. ${Math.round(diff)} √•r f√∏r folkepension (${state.fpAge} √•r, estimat).`;
  } else {
    $("stopSub").textContent = "‚Äî";
  }
}
function recomputeVisibleActions(){
  const base = state.baseStop;
  const fp = state.fpAge;
  const a = state.age;
  const s = state.savings;
  const m = state.monthly;
  const inc = state.income;
  if (![base,fp,a,s,m,inc].every(x=>isFinite(x))) { state.visibleActions=[]; return; }
  // compute effect for each action as months gained
  const enriched = ACTIONS.map(act=>{
    const newStop = solveStopAge(a, fp, s, m + act.monthly, inc);
    const months = Math.max(0, yearsToMonths(base - newStop)); // earlier stop => smaller age
    return {...act, months, newStop};
  });
  // only show >=1 month effect, sort desc months then monthly desc, limit 5
  state.visibleActions = enriched.filter(x=>x.months>=1).sort((x,y)=> (y.months-x.months) || (y.monthly-x.monthly)).slice(0,5);
  // reset selection to visible ids only
  const visibleIds = new Set(state.visibleActions.map(x=>x.id));
  state.selected.forEach(id=>{ if (!visibleIds.has(id)) state.selected.delete(id); });
}
function renderActions(){
  recomputeVisibleActions();
  const list = $("actionList");
  list.innerHTML = "";
  if (state.visibleActions.length===0){
    list.innerHTML = `<div class="small">Ingen konkrete greb giver mindst 1 m√•ned effekt med dine nuv√¶rende tal.</div>`;
  } else {
    for (const act of state.visibleActions){
      const sel = state.selected.has(act.id);
      const eff = fmtDeltaMonths(act.months);
      const el = document.createElement("div");
      el.className = "actionCard" + (sel?" selected":"");
      el.setAttribute("data-action","toggleAction");
      el.setAttribute("data-id", act.id);
      el.innerHTML = `
        <div class="actionLeft">
          <div style="font-size:22px; line-height:1;">${act.id==="car_less"?"üöó":act.id==="vacation"?"üèñÔ∏è":act.id==="subscriptions"?"üì∫":act.id==="groceries"?"üõí":act.id==="transport"?"‚õΩ":"‚úÖ"}</div>
          <div>
            <div class="actionTitle">${act.title}</div>
            <div class="badge">${act.tag}</div>
          </div>
        </div>
        <div class="actionRight">
          <div class="effect">${eff}</div>
          <div class="kr">${fmtInt(act.monthly)}<span class="small"> kr./md</span></div>
        </div>
      `;
      list.appendChild(el);
    }
  }
  renderSumLift();
}

function renderNewResult(){
  const base = state.baseStop;
  const fp = state.fpAge;
  const extra = selectedExtraMonthly();
  const newStop = isFinite(state.newStop) ? state.newStop : solveStopAge(state.age, fp, state.savings, state.monthly + extra, state.income);
  const baseR = isFinite(base) ? Math.round(base) : "‚Äî";
  const newR = isFinite(newStop) ? Math.round(newStop) : "‚Äî";
  const a = $("baseStopLbl"); if (a) a.textContent = baseR;
  const b = $("newStopLbl"); if (b) b.textContent = newR;
  const c = $("newStopBig"); if (c) c.textContent = newR;

  if (isFinite(base) && isFinite(newStop)){
    const liftM = Math.max(0, yearsToMonths(base - newStop));
    const lift = fmtDeltaMonths(liftM);
    const d = $("newLiftLbl"); if (d) d.textContent = lift;
    const diffY = Math.max(0, (state.fpAge - newStop));
    const e = $("newStopSub"); if (e) e.textContent = `Det svarer til ca. ${Math.round(diffY)} √•r f√∏r folkepension (${state.fpAge} √•r, estimat).`;
  } else {
    const d = $("newLiftLbl"); if (d) d.textContent = "‚Äî";
    const e = $("newStopSub"); if (e) e.textContent = "‚Äî";
  }
}
function renderSumLift(){
  const base = state.baseStop;
  const fp = state.fpAge;
  if (!isFinite(base) || !isFinite(fp)) { $("sumLift").textContent="+0 md"; return; }
  let extra = 0;
  for (const id of state.selected){
    const act = state.visibleActions.find(x=>x.id===id);
    if (act) extra += act.monthly;
  }
  const newStop = solveStopAge(state.age, fp, state.savings, state.monthly + extra, state.income);
  const months = Math.max(0, yearsToMonths(base - newStop));
  $("sumLift").textContent = fmtDeltaMonths(months);
}
function selectedExtraMonthly(){
  let extra=0;
  for (const id of state.selected){
    const act = state.visibleActions.find(x=>x.id===id);
    if (act) extra += act.monthly;
  }
  return extra;
}

// --- validation ---
function requireAge(){
  const n = parseMoney($("ageInput").value);
  if (!isFinite(n) || n<16 || n>100) return false;
  state.age = Math.round(n);
  updateFpAge();
  return true;
}
function requireNumbers(){
  const sRaw = $("savInput")?.value ?? "";
  const mRaw = $("invInput")?.value ?? "";
  const iRaw = $("incInput")?.value ?? "";

  const s = moneyOrNull(sRaw);
  const m = moneyOrNull(mRaw);
  const inc = moneyOrNull(iRaw);

  const sOk = isFinite(s) && s > 0;
  const mOk = isFinite(m) && m > 0;
  const incOk = (inc === null) || (isFinite(inc) && inc >= 0);

  const err = document.getElementById("numbersErr");
  const btn = document.getElementById("computeBtn");

  if (!incOk){
    if (err){ err.style.display="block"; err.textContent="Indkomst skal v√¶re et tal (0 eller h√∏jere)."; }
    if (btn) btn.classList.add("disabled");
    return false;
  }

  if (!sOk && !mOk){
    if (err){ err.style.display="block"; err.textContent="Indtast enten opsparing i dag eller m√•nedlig investering (mindst √©t felt skal udfyldes)."; }
    if (btn) btn.classList.add("disabled");
    return false;
  }

  if (err){ err.style.display="none"; err.textContent=""; }
  if (btn) btn.classList.remove("disabled");

  state.savings = sOk ? Math.round(s) : 0;
  state.monthly = mOk ? Math.round(m) : 0;
  state.income = (inc === null) ? 0 : Math.round(inc);
  return true;
}


function validateNumbersStep(){
  const s = moneyOrNull($("savInput")?.value ?? "");
  const m = moneyOrNull($("invInput")?.value ?? "");
  const inc = moneyOrNull($("incInput")?.value ?? "");

  const sOk = isFinite(s) && s > 0;
  const mOk = isFinite(m) && m > 0;
  const incOk = (inc === null) || (isFinite(inc) && inc >= 0);

  const btn = document.getElementById("computeBtn");
  const err = document.getElementById("numbersErr");

  if (btn){
    if ((sOk || mOk) && incOk) btn.classList.remove("disabled");
    else btn.classList.add("disabled");
  }
  if (err && (sOk || mOk) && incOk){
    err.style.display="none"; err.textContent="";
  }
}

function hookNumbersValidation(){
  ["savInput","invInput","incInput"].forEach(id=>{
    const el = document.getElementById(id);
    if (!el) return;
    ["input","change","keyup"].forEach(evt=> el.addEventListener(evt, validateNumbersStep, {passive:true}));
  });
  validateNumbersStep();
}

// --- event delegation (single binding) ---
document.addEventListener("click", (e)=>{
  const el = e.target.closest("[data-action]");
  if (!el) return;
  const act = el.getAttribute("data-action");

  if (act==="start"){ setActiveStep(1); return; }

  if (act==="toggleHint"){
    const id = el.getAttribute("data-hint");
    const box = $(id);
    if (box) box.classList.toggle("open");
    return;
  }

  if (act==="next"){
    if (!requireAge()) return;
    setActiveStep(2);
    return;
  }

  if (act==="compute"){
    if (!requireNumbers()) return;
    if (!isFinite(state.age)) return;
    if (!state.fpAge) updateFpAge();
    if (!computeBase()) return;
    renderResult();
    setActiveStep(3);
    return;
  }

  if (act==="backToNumbers"){ setActiveStep(2); return; }
  if (act==="toActions"){ renderActions(); setActiveStep(4); return; }
  if (act==="backToResult"){ setActiveStep(3); return; }
  if (act==="backToActions"){ setActiveStep(4); return; }

  if (act==="toggleAction"){
    const id = el.getAttribute("data-id");
    if (!id) return;
    if (state.selected.has(id)) state.selected.delete(id); else state.selected.add(id);
    renderActions();
    if (state.step===5) renderReality();
    return;
  }

  if (act==="openLead"){ openSheet("lead"); return; }

  if (act==="openAssumptions"){ openSheet("assumptions"); return; }

  if (act==="toNewResult"){
    renderActions();
    const extra = selectedExtraMonthly();
    state.newStop = solveStopAge(state.age, state.fpAge, state.savings, state.monthly + extra, state.income);
    renderNewResult();
    setActiveStep(5);
    return;
  }

  if (act==="openWhatItTakes"){ openSheet("whatItTakes"); return; }

  if (act==="restart"){
    state.step = 0;
    state.age = null; state.fpAge=null; state.savings=null; state.monthly=null; state.income=null;
    state.baseStop=null; state.newStop=null;
    state.selected = new Set();
    state.visibleActions = [];
    ["ageInput","savInput","invInput","incInput"].forEach(id=>{ const inp = $(id); if (inp) inp.value=""; });
    closeSheet();
    document.querySelectorAll(".hint.open").forEach(x=>x.classList.remove("open"));
    const fpBig = $("fpAgeBig"); if (fpBig) fpBig.textContent="‚Äî";
    setActiveStep(0);
    return;
  }

  if (act==="closeSheet"){ closeSheet(); return; }

  if (act==="sendLead"){
    const name = ($("leadName")?.value || "").trim();
    const email = ($("leadEmail")?.value || "").trim();
    const phone = ($("leadPhone")?.value || "").trim();
    const consent = !!$("leadConsent")?.checked;
    const err = $("leadErr");
    const ok = consent && name.length>=2 && (email.includes("@") || phone.replace(/\D/g,"").length>=8);
    if (!ok){
      if (err) err.style.display="block";
      return;
    }
    if (err) err.style.display="none";
    // Demo mode: no endpoint. Provide clear UX.
    $("sheetBody").innerHTML = `
      <div class="p" style="font-size:15px;">Tak. Din kontakt er klar til at blive sendt, n√•r der er sat en mail/endpoint op.</div>
      <div class="small">Indtil da gemmes den ikke. (Ingen skjult tracking.)</div>
      <div class="hr"></div>
      <button class="cta" data-action="closeSheet" type="button">Luk</button>
    `;
    return;
  }
});

// sheet backdrop close + esc
$("backdrop").addEventListener("click", closeSheet, {passive:true});
document.addEventListener("keydown", (e)=>{ if (e.key==="Escape") closeSheet(); });

// live update fp age on age input
$("ageInput").addEventListener("input", ()=>{
  const n = parseMoney($("ageInput").value);
  state.age = isFinite(n)? Math.round(n) : null;
  updateFpAge();
}, {passive:true});

window.addEventListener("DOMContentLoaded", ()=>{ try{ hookNumbersValidation(); }catch(e){} });

// init
setActiveStep(0);
</script>
</body>
</html>
