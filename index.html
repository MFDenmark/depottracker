<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PensionenOptimer — V9.1</title>
  <meta name="theme-color" content="#2c6cff">
  <style>
    :root{
      --bg1:#f6fbff; --bg2:#eef5ff;
      --card:#ffffff; --text:#0b1220; --muted:#5a6b85; --line:#e7eef8;
      --blue:#2c6cff; --blue2:#1f4ed8; --alt:#00a6ff;
      --shadow: 0 18px 45px rgba(10,30,80,0.10);
      --radius: 18px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--font); color:var(--text); min-height:100vh;
      background:
        radial-gradient(1200px 800px at 20% 10%, #d7ebff 0%, rgba(215,235,255,0) 60%),
        radial-gradient(1000px 700px at 80% 20%, #d9fff6 0%, rgba(217,255,246,0) 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    .app{max-width:460px; margin:0 auto; padding:16px 14px 18px;}
    .topbar{display:flex; align-items:center; justify-content:space-between; padding:10px 6px 14px; position:sticky; top:0; z-index:20; background: linear-gradient(180deg, rgba(246,251,255,0.96), rgba(246,251,255,0.70)); backdrop-filter: blur(10px);}
    .brand{display:flex; gap:10px; align-items:center; cursor:pointer; user-select:none;}
    .dot{width:12px;height:12px;border-radius:999px;background: linear-gradient(135deg, var(--blue), var(--alt));box-shadow:0 8px 18px rgba(44,108,255,0.25);}
    .name{font-weight:950; letter-spacing:0.2px}
    .tag{font-size:12px;color:var(--muted);margin-top:1px}
    .badge{font-size:11px; padding:4px 8px; border-radius:999px;border:1px solid rgba(44,108,255,0.18); background: rgba(44,108,255,0.08); color:#1c3f9e;margin-left:8px; font-weight:800;}
    .screen{display:flex; flex-direction:column; gap:18px;}
    .card{background: rgba(255,255,255,0.90);border: 1px solid rgba(231,238,248,0.9);box-shadow: var(--shadow);border-radius: var(--radius);padding: 18px 16px;backdrop-filter: blur(8px);}
    .hidden{display:none}
    .kicker{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.12em;margin-bottom:8px;}
    h1,h2{margin:0 0 10px}
    h1{font-size:22px;line-height:1.2}
    h2{font-size:20px;line-height:1.2}
    p{margin:0 0 12px;line-height:1.5}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .footnote{font-size:12px;color:var(--muted);margin-top:10px}
    .strong{font-weight:950}
    .row{display:flex;gap:10px;align-items:center}
    .between{justify-content:space-between}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .field{display:flex;flex-direction:column;gap:6px;margin: 10px 0}
    label{font-size:13px;color:#30415f}
    input, select{border: 1px solid var(--line);background:#fff;border-radius: 14px;padding: 12px 12px;font-size:16px;outline:none;}
    input:focus, select:focus{border-color: rgba(44,108,255,0.55);box-shadow: 0 0 0 4px rgba(44,108,255,0.10)}
    button{border:1px solid transparent;border-radius: 14px;padding: 12px 12px;font-size:14px;cursor:pointer;}
    button.primary{background: linear-gradient(135deg, var(--blue), var(--blue2));color:#fff;box-shadow: 0 14px 28px rgba(44,108,255,0.22);flex:1;font-weight:850;}
    button.ghost{background: rgba(255,255,255,0.65);border-color: var(--line);color:#20314c;font-weight:750;}
    button.smallBtn{padding:8px 10px;border-radius:12px;font-size:12px;font-weight:900}
    .pill{display:inline-flex; align-items:center; gap:8px;font-size:12px; padding: 8px 10px; border-radius: 999px;border:1px solid rgba(44,108,255,0.20);background: rgba(44,108,255,0.08);color:#1c3f9e;font-weight:850;white-space:nowrap;}
    .pill.good{border-color: rgba(0,166,255,0.25); background: rgba(0,166,255,0.10); color:#055a84}
    .hero{padding: 8px 0 0}
    .heroAge{font-size:52px;font-weight:980;letter-spacing:-0.02em; line-height:1}
    .heroDelta{margin-top:10px; display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .heroHint{margin-top:10px; font-size:12px; color:var(--muted);}
    .preview{border:1px solid var(--line);border-radius: 16px;padding: 12px 12px;background: rgba(255,255,255,0.7);margin-top:12px;}
    .previewTitle{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.12em;margin-bottom:8px}
    .previewRow{display:flex;justify-content:space-between;gap:10px;padding:8px 0;border-top:1px dashed rgba(90,107,133,0.25)}
    .previewRow:first-of-type{border-top:none}
    .miniChart{border: 1px solid var(--line);border-radius: 16px;padding: 12px 12px;background: rgba(255,255,255,0.7);margin-top:12px;}
    .bar{display:grid;grid-template-columns:70px 1fr 62px;gap:10px;align-items:center;margin:10px 0}
    .track{height:10px;border-radius:999px;background:#edf3ff;overflow:hidden;border:1px solid rgba(44,108,255,0.10)}
    .fill{height:100%;width:50%;background: linear-gradient(90deg, rgba(44,108,255,0.35), rgba(44,108,255,0.95))}
    .fill.alt{background: linear-gradient(90deg, rgba(0,166,255,0.35), rgba(0,166,255,0.95))}
    .label{font-size:12px;color:var(--muted)}
    .val{font-size:12px;color:#2a3b57;text-align:right}
    input[type="range"]{width:100%}
    .choiceList{display:flex;flex-direction:column;gap:10px;margin-top:12px}
    .choiceItem{border:1px solid var(--line);border-radius: 16px;padding: 12px 12px;background: rgba(255,255,255,0.75);display:flex; justify-content:space-between; gap:12px;}
    .choiceTitle{font-weight:950}
    .choiceMeta{font-size:12px;color:var(--muted);margin-top:4px}
    .toggle{display:flex; flex-direction:column; align-items:flex-end; gap:8px;min-width: 130px;}
    .switch{width: 46px; height: 28px; border-radius: 999px;background: #e8f0ff; border:1px solid rgba(44,108,255,0.18);position: relative;}
    .knob{width: 22px; height: 22px; border-radius: 999px;background: #fff; position:absolute; top:2px; left:2px;box-shadow: 0 8px 14px rgba(10,30,80,0.12);transition: left 160ms ease;}
    .switch.on{background: rgba(44,108,255,0.20); border-color: rgba(44,108,255,0.35);}
    .switch.on .knob{left: 22px;}
    .switchBtn{background:transparent;border:none;padding:0;cursor:pointer}
    pre.payload{background:#0b1220; color:#d7e6ff;border-radius:16px; padding:12px;overflow:auto; max-height:320px;font-size:12px; line-height:1.45;}
    .bottombar{display:flex; justify-content:space-between; padding:14px 6px 0}
    .adminList{display:flex; flex-direction:column; gap:10px; margin-top:10px}
    .leadCard{border:1px solid var(--line);border-radius: 16px;padding: 12px 12px;background: rgba(255,255,255,0.75);}
    .leadHead{display:flex;justify-content:space-between;gap:10px}
    .leadName{font-weight:980}
    .leadTime{font-size:12px;color:var(--muted)}
    details > summary{list-style:none; cursor:pointer}
    details > summary::-webkit-details-marker{display:none}
    .nav{position: sticky; bottom: 0; z-index: 10;padding-top: 10px;}
    .navInner{background: rgba(255,255,255,0.80);border: 1px solid rgba(231,238,248,0.95);box-shadow: 0 18px 45px rgba(10,30,80,0.10);border-radius: 16px;display:grid;grid-template-columns: 1fr 1fr 1fr;gap: 8px;padding: 8px;backdrop-filter: blur(10px);}
    .navBtn{background: transparent;border: 1px solid transparent;border-radius: 14px;padding: 10px 10px;font-weight:900;color:#22334f;cursor:pointer;font-size:13px;}
    .navBtn.active{background: rgba(44,108,255,0.10);border-color: rgba(44,108,255,0.18);color:#1c3f9e;}
    .microTrust{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;}
    .microTrust .pill{font-weight:800}
    .pulse{animation:pulse 420ms ease-out}
    @keyframes pulse{0%{transform:scale(1); opacity:1} 40%{transform:scale(1.03); opacity:1} 100%{transform:scale(1); opacity:1}}
  
    .progressWrap{display:flex;align-items:center;gap:10px;margin:10px 0 0}
    .progressBar{flex:1;height:10px;border-radius:999px;background:#edf3ff;border:1px solid rgba(44,108,255,0.10);overflow:hidden}
    .progressFill{height:100%;width:0%;background:linear-gradient(90deg, rgba(44,108,255,0.35), rgba(44,108,255,0.95));transition:width 220ms ease}
    .progressTxt{font-size:12px;color:var(--muted);white-space:nowrap}
    .iconPill{display:inline-flex;align-items:center;gap:8px}
    .hintBox{border:1px solid var(--line);background:rgba(255,255,255,0.7);border-radius:16px;padding:12px;margin-top:10px}
    .hintTitle{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:0.12em;margin-bottom:6px}
    .inlineError{display:none;margin-top:8px;color:#9a1b1b;font-size:12px;font-weight:800}
    .inlineError.show{display:block}
    .linkBtn{background:transparent;border:none;color:#1c3f9e;font-weight:900;cursor:pointer;padding:0}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:86px;z-index:50;background:rgba(11,18,32,0.92);color:#d7e6ff;padding:10px 12px;border-radius:14px;font-size:12px;max-width:92vw;box-shadow:0 18px 45px rgba(10,30,80,0.20);display:none}
    .toast.show{display:block}
    .modalOverlay{position:fixed;inset:0;background:rgba(11,18,32,0.55);backdrop-filter:blur(8px);z-index:60;display:none;align-items:center;justify-content:center;padding:16px}
    .modalOverlay.show{display:flex}
    .modal{max-width:460px;width:100%;background:rgba(255,255,255,0.92);border:1px solid rgba(231,238,248,0.95);border-radius:18px;box-shadow:0 18px 45px rgba(10,30,80,0.18);padding:16px}
    .modalHead{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .modalTitle{font-weight:980;font-size:16px;margin:0}
    .modalBody{margin-top:10px;color:#22334f;font-size:13px;line-height:1.5}
    .modalBody ul{margin:8px 0 0 18px}
    .modalClose{border:1px solid var(--line);background:rgba(255,255,255,0.7);border-radius:12px;padding:8px 10px;font-size:12px;font-weight:900;cursor:pointer}
    .stepDots{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .dotStep{width:10px;height:10px;border-radius:999px;background:rgba(44,108,255,0.15);border:1px solid rgba(44,108,255,0.18)}
    .dotStep.on{background:rgba(44,108,255,0.70);border-color:rgba(44,108,255,0.35)}


    .debugFab{
      position:fixed; right:12px; bottom:150px; z-index:70;
      display:none;
      border:1px solid rgba(231,238,248,0.95);
      background:rgba(255,255,255,0.85);
      backdrop-filter: blur(10px);
      border-radius: 999px;
      padding:10px 12px;
      font-weight:950;
      box-shadow: 0 18px 45px rgba(10,30,80,0.14);
      cursor:pointer;
      font-size:12px;
      color:#1c3f9e;
    }
    .debugFab.show{display:block}
    .debugPre{
      background:#0b1220; color:#d7e6ff; border-radius:14px; padding:10px;
      font-size:12px; line-height:1.45; overflow:auto; max-height:45vh;
      border:1px solid rgba(215,230,255,0.10);
    }

  
    /* V5 discipline */
    .heroAge{font-size:64px; letter-spacing:-1px}
    .heroCard{position:relative; overflow:hidden}
    .timeRing{
      position:absolute; inset:-80px -80px auto auto;
      width:220px; height:220px; border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(0,166,255,0.35), rgba(44,108,255,0.15) 45%, rgba(44,108,255,0.00) 70%);
      border:1px solid rgba(44,108,255,0.14);
      pointer-events:none;
    }
    .timeRing::after{content:''; position:absolute; inset:34px; border-radius:999px; border:1px dashed rgba(44,108,255,0.22);}
    .heroHuman{margin-top:8px;font-size:13px;color:var(--muted)}
    .secondaryLink{background:transparent;border:none;color:#1c3f9e;font-weight:900;padding:8px 10px;cursor:pointer}
    .secondaryLink.small{font-size:12px;padding:6px 8px}
    .nav{display:none}
    .nav.ready{display:block}
    .chip{display:inline-flex;align-items:center;gap:6px;border-radius:999px;padding:4px 8px;font-size:11px;font-weight:900;border:1px solid rgba(90,107,133,0.22);background:rgba(255,255,255,0.70);color:#22334f}
    .chip.easy{border-color:rgba(0,166,255,0.30);background:rgba(0,166,255,0.10);color:#055a84}
    .chip.med{border-color:rgba(44,108,255,0.30);background:rgba(44,108,255,0.08);color:#1c3f9e}
    .chip.hard{border-color:rgba(90,107,133,0.28);background:rgba(90,107,133,0.06);color:#22334f}
    .choiceMetaRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .gateNote{margin-top:10px;font-size:12px;color:var(--muted)}
    .disabled{opacity:0.55; pointer-events:none}
    .btnRowOne{display:flex; gap:10px; align-items:center}
    .btnRowOne .primary{flex:1}

  
.heroAge{font-size:58px;font-weight:900;letter-spacing:-0.03em;margin-top:6px;margin-bottom:8px;}
.heroSub{font-size:14px;opacity:0.85;}
.card{transition:transform .18s ease, box-shadow .18s ease;}
.card:hover{transform:translateY(-2px);}
.ringWrap{display:flex;justify-content:center;align-items:center;margin:20px 0;}
.timeRing{width:160px;height:160px;border-radius:50%;
background:conic-gradient(var(--blue) 0deg,#e8eefc 0deg);
display:flex;align-items:center;justify-content:center;transition:background .3s ease;}
.timeRingInner{width:120px;height:120px;background:#fff;border-radius:50%;
display:flex;align-items:center;justify-content:center;font-weight:900;font-size:18px;}

</style>
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand" id="btnHome" title="Hjem (beholder dine valg)">
        <div class="dot"></div>
        <div>
          <div class="name">PensionenOptimer <span class="badge">V9.1</span></div>
          <div class="tag">Konservativ simulering · ingen login · gem som link</div>
        </div>
      </div>
      <button type="button" class="ghost" id="btnAdminTop">…</button>
    </header>

    <div style="padding:0 6px 10px">
      <div style="height:8px;background:#e8eefc;border-radius:999px;overflow:hidden;border:1px solid rgba(44,108,255,0.12)">
        <div id="progressBar" style="height:100%;width:20%;background:linear-gradient(90deg,var(--blue),var(--alt));transition:width .25s ease"></div>
      </div>
      <div class="muted small" id="progressLabel" style="margin-top:6px">Trin 1/5</div>
    </div>
    

    <main class="screen">
      <section class="card" data-screen="start">
        <div class="kicker">Start</div>
</div>
          <div class="progressTxt">Trin 1/5</div>
        </div>
    
        <h1>Hvor meget tid kan du købe tilbage?</h1>
        <p class="muted">Indtast din alder. Du ser resultatet i <strong>tid</strong> — og hvad små valg kan gøre. <button type="button" class="linkBtn" id="btnWhatIsTime">Hvad betyder “tid”?</button></p>

        <div class="field">
          <label for="age">Din alder</label>
          <input id="age" type="number" inputmode="numeric" min="18" max="70" placeholder="fx 38" />
        </div>
        <div class="inlineError" id="errAge">Indtast en alder mellem 18 og 70 for at fortsætte.</div>

        <div class="microTrust">
<span class="pill">Konservativ simulering</span>
          <span class="pill">Ingen login</span>
          <span class="pill">Ikke rådgivning</span>
        </div>

        <div class="row" style="margin-top:12px">
          <button type="button" class="primary" id="btnContinue">Fortsæt</button>
          <button type="button" class="ghost" id="btnDemo">Demo</button>
          <button type="button" class="ghost" id="btnTutorial">Sådan virker det</button>
        </div>

        <p class="footnote">Du kan altid justere beløb og valg bagefter.</p>
      </section>

      <section class="card hidden" data-screen="setup">
        <div class="kicker">Realisme</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackSetup" type="button">Tilbage</button></div>
</div>
          <div class="progressTxt">Trin 2/5</div>
        </div>
    
        <h2>Gør det realistisk (på 30 sek.)</h2>
        <p class="muted">Vælg et beløb du realistisk kan afsætte — og tilføj kontant opsparing hvis du har en.</p>

        <div class="field">
          <label for="extraMonthly">Hvor meget kan du afsætte ekstra pr. måned? (kr.)</label>
          <input id="extraMonthly" type="number" inputmode="numeric" min="0" placeholder="fx 1200" />
        </div>
        <div class="inlineError" id="errPayout">Indtast et realistisk månedligt beløb (0 eller mere).</div>

        <div class="field">
          <label for="currentSavings">Kontant opsparing (kr.)</label>
          <input id="currentSavings" type="number" inputmode="numeric" min="0" placeholder="fx 250000" />
        </div>

        
        <div class="hintBox">
          <div class="hintTitle">Inspiration</div>
          <div class="muted small">Har du svært ved at finde beløbet? Brug “Små valg” og se effekten.</div>
          <div class="row" style="margin-top:10px">
            <button type="button" class="ghost" id="btnHelpFindMoney" style="flex:1">Hjælp mig finde beløbet</button>
          </div>
        </div>

        <div class="preview">
          <div class="previewTitle">Preview (opdateres med det samme)</div>
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="setupPossible">—</div></div>
          <div class="previewRow"><div>Tidsgevinst</div><div class="strong" id="setupDelta">—</div></div>
          <div class="previewRow"><div>Samlet ekstra pr. måned</div><div class="strong" id="setupTotalExtra">—</div></div>
        </div>

        <div class="row">
          <button type="button" class="primary" id="btnSeeResult">Se resultat</button>
          <button type="button" class="ghost" id="btnBackToStart">Tilbage</button>
        </div>
      </section>


      <section class="card hidden" data-screen="inspiration">
        <div class="kicker">Inspiration</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackInsp" type="button">Tilbage</button></div>
        <h2>Små handlinger giver effekt over tid</h2>
        <p class="muted">Vælg et realistisk niveau. Beløbet forudfyldes – du kan altid ændre senere.</p>

        <div class="preview">
          <div class="previewTitle">Forventet effekt (konservativt)</div>
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="inspPossible">—</div></div>
          <div class="previewRow"><div>Tidsgevinst</div><div class="strong" id="inspDelta">—</div></div>
          <div class="previewRow"><div>Valgt beløb</div><div class="strong" id="inspChosen">—</div></div>
        </div>

        <div style="margin-top:12px">
          <div class="kicker" style="margin-bottom:6px">Små justeringer (0–2.500 kr./md)</div>
          <div class="choiceList" id="tier1List"></div>
        </div>

        <div style="margin-top:12px">
          <div class="kicker" style="margin-bottom:6px">Mellem (2.500–5.000 kr./md)</div>
          <div class="choiceList" id="tier2List"></div>
        </div>

        <div style="margin-top:12px">
          <div class="kicker" style="margin-bottom:6px">Strukturelle valg (5.000+ kr./md)</div>
          <div class="choiceList" id="tier3List"></div>
        </div>

        <div class="btnRowOne" style="margin-top:12px">
          <button class="primary" id="btnUseInsp" type="button">Brug dette beløb</button>
          <button class="secondaryLink" id="btnSkipInsp" type="button">Jeg indtaster selv</button>
        </div>
      </section>

      <section class="card hidden heroCard" data-screen="hero">
        <div class="kicker">Resultat</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackHero" type="button">Tilbage</button></div>
        <div class="timeRing" aria-hidden="true"></div>
</div>
          <div class="progressTxt">Trin 3/5</div>
        </div>
    
        <div class="hero"><div class="ringWrap"><div class="timeRing" id="timeRing"><div class="timeRingInner" id="ringLabel">0%</div></div></div>
          <div class="heroAge" id="heroPossible">—</div>
          <div class="heroDelta">
            <span class="pill good" style="font-size:11px" id="pillDelta">+ —</span>
            <span class="muted small">Normal: <span id="heroNormal">—</span></span>
          </div>
          <div class="heroHint" id="heroHint">—</div>
        </div>

        <details style="margin-top:12px">
          <summary class="muted">Vis grundlag (afkast, udbetaling, mv.)</summary>
          <div class="preview" style="margin-top:10px">
            <div class="previewRow"><div>Udbetaling (reference)</div><div class="strong" id="heroPayout">—</div></div>
            <div class="previewRow"><div>Afkast (lang sigt)</div><div class="strong" id="heroReturn">—</div></div>
            <div class="previewRow"><div>Samlet ekstra pr. måned</div><div class="strong" id="heroTotalExtra">—</div></div>
          </div>
        </details>

        <div class="miniChart" aria-label="Normal vs mulig pensionsalder">
          <div class="bar">
            <div class="label">Normal</div>
            <div class="track"><div class="fill" id="barNormal"></div></div>
            <div class="val" id="valNormal">—</div>
          </div>
          <div class="bar">
            <div class="label">Mulig</div>
            <div class="track"><div class="fill alt" id="barPossible"></div></div>
            <div class="val" id="valPossible">—</div>
          </div>
        </div>

        <div class="row">
          <button type="button" class="primary" id="btnAdjust">Justér</button>
          <button type="button" class="ghost" id="btnChoices">Små valg</button>
        </div>
        <div class="row" style="margin-top:8px">
          <button type="button" class="ghost" id="btnAssumptions" style="flex:1">Tilpas forudsætninger</button>
        </div>
      </section>

      <section class="card hidden" data-screen="adjust">
        <div class="kicker">Justér</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackAdjustTop" type="button">Tilbage</button></div>
</div>
          <div class="progressTxt">Trin 4/5</div>
        </div>
    
        <h2>Ekstra opsparing pr. måned</h2>
        <p class="muted">Slider er kun et hurtigtvalg — manuel kan være højere.</p>

        <div class="row between">
          <div class="strong">+ <span id="extraLbl">0</span> kr./md</div>
          <button type="button" class="ghost smallBtn" id="btnBackFromAdjust">Tilbage</button>
        </div>

        <input id="extraRange" type="range" min="0" max="5000" step="100" value="0" />
        <div class="row between muted small"><span>0</span><span>5.000</span></div>

        <div class="field">
          <label for="extraManual">Eller indtast beløb</label>
          <input id="extraManual" type="number" inputmode="numeric" min="0" placeholder="fx 1200" />
        </div>

        <div class="preview">
          <div class="previewTitle">Opdateret resultat</div>
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="adjPossible">—</div></div>
          <div class="previewRow"><div>Tidsgevinst</div><div class="strong" id="adjDelta">—</div></div>
          <div class="previewRow"><div>Valgte “Små valg”</div><div class="strong" id="adjChoices">0</div></div>
          <div class="previewRow"><div>Samlet ekstra pr. måned</div><div class="strong" id="adjTotalExtra">—</div></div>
        </div>

        <div class="row">
          <button type="button" class="primary" id="btnToChoicesFromAdjust">Små valg</button>
          <button type="button" class="ghost" id="btnToGainFromAdjust">Din gevinst</button>
        </div>
      </section>

      <section class="card hidden" data-screen="choices">
        <div class="kicker">Små valg</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackChoicesTop" type="button">Tilbage</button></div>
</div>
          <div class="progressTxt">Trin 4/5</div>
        </div>
    
        <div class="row between">
          <h2 style="margin:0">Top 3 forslag (du kan vælge flere)</h2>
          <button type="button" class="ghost smallBtn" id="btnBackFromChoices">Tilbage</button>
        </div>
        <p class="muted">Tryk på valgene. Du ser effekten i tid med det samme.</p>

        <div class="preview">
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="choicesPossible">—</div></div>
          <div class="previewRow"><div>Tidsgevinst</div><div class="strong" id="choicesDelta">—</div></div>
          <div class="previewRow"><div>Samlet ekstra pr. måned</div><div class="strong" id="choicesTotalExtra">—</div></div>
        </div>

        <div class="choiceList" id="choiceList"></div>

        <div class="row">
          <button type="button" class="primary" id="btnMoreChoices">Vis 3 flere</button>
          <button type="button" class="ghost" id="btnToGain">Din gevinst</button>
        </div>
      </section>

      <section class="card hidden" data-screen="gain">
        <div class="kicker">Checkpoint</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackGainTop" type="button">Tilbage</button></div>
</div>
          <div class="progressTxt">Trin 5/5</div>
        </div>
    
        <div class="row between">
          <h2 style="margin:0">Din gevinst</h2>
          <span class="pill good" style="font-size:11px" id="gainPill">+ —</span>
        </div>

        <div class="preview">
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="gainPossible">—</div></div>
          <div class="previewRow"><div>Normal pensionsalder</div><div class="strong" id="gainNormal">—</div></div>
        </div>

        <div class="preview" style="margin-top:12px">
          <div class="previewTitle">Din plan (nu)</div>
          <div class="previewRow"><div>Kontant opsparing</div><div class="strong" id="gainSavings">—</div></div>
          <div class="previewRow"><div>Ekstra pr. måned</div><div class="strong" id="gainExtraManual">—</div></div>
          <div class="previewRow"><div>Valgte valg</div><div class="strong" id="gainChoices">—</div></div>
          <div class="previewRow"><div>Samlet ekstra pr. måned</div><div class="strong" id="gainTotalExtra">—</div></div>
        </div>

        <div class="preview" style="margin-top:12px">
          <div class="previewTitle">Seneste check-in</div>
          <div class="previewRow"><div>Sidste check-in</div><div class="strong" id="mLast">—</div></div>
          <div class="previewRow"><div>Udvikling</div><div class="strong" id="mDelta">—</div></div>
        </div>

        <p class="muted small" style="margin-top:12px">Vil du have en realistisk plan for at nå dette?</p>
        
        <div class="row">
          <button type="button" class="primary" id="btnLead">Få en konkret plan</button>
          <div class="gateNote" id="leadGateNote"></div>
          <button type="button" class="ghost" id="btnSavePlan">Gem plan (link)</button>
          <button type="button" class="ghost" id="btnBackFromGain">Tilbage</button>
        </div>

      </section>

      <section class="card hidden" data-screen="assumptions">
        <div class="kicker">Forudsætninger</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackAssumptionsTop" type="button">Tilbage</button></div>
        <h2>Beregningsgrundlag</h2>
        <p class="muted">Sekundært. Brug kun hvis relevant.</p>

        <div class="field">
          <label for="payout">Referenceudbetaling (kr./md)</label>
          <select id="payout">
            <option value="18000">18.000</option>
            <option value="20000" selected>20.000 (standard)</option>
            <option value="22000">22.000</option>
            <option value="25000">25.000</option>
            <option value="custom">Egen værdi…</option>
          </select>
        </div>
        <div class="field hidden" id="payoutCustomWrap">
          <label for="payoutCustom">Egen referenceudbetaling</label>
          <input id="payoutCustom" type="number" inputmode="numeric" min="5000" placeholder="fx 21000" />
        </div>

        <div class="field">
          <label for="returnRate">Afkast (langt sigt)</label>
          <select id="returnRate">
            <option value="0.06">6%</option>
            <option value="0.07" selected>7% (default)</option>
            <option value="0.08">8%</option>
</select>
        </div>

        <div class="row">
          <button type="button" class="primary" id="btnApply">Anvend</button>
          <button type="button" class="ghost" id="btnBackFromAssumptions">Tilbage</button>
        </div>
      </section>

      
      <section class="card hidden" data-screen="lead1">
        <div class="kicker">Plan</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackLead1Top" type="button">Tilbage</button></div>
        <h2>Få en konkret plan</h2>
        <p class="muted">Start med minimal info. Du ser præcis hvad der sendes før du godkender.</p>

        <div class="field">
          <label for="intent">Hvad ønsker du?</label>
          <select id="intent">
            <option value="tidligere_pension">Tidligere pension</option>
            <option value="overblik">Overblik</option>
            <option value="optimere_opsparing">Optimere opsparing</option>
          </select>
        </div>

        <div class="grid2">
          <div class="field"><label for="firstName">Fornavn</label><input id="firstName" type="text" placeholder="Fornavn"></div>
          <div class="field"><label for="email">Email</label><input id="email" type="email" placeholder="navn@domain.dk"></div>
        </div>

        <div class="inlineError" id="errLead1">Udfyld fornavn og en gyldig email.</div>

        <div class="btnRowOne" style="margin-top:10px">
          <button class="primary" id="btnLeadNext" type="button">Næste</button>
          <button class="secondaryLink" id="btnBackToPlan" type="button">Tilbage</button>
        </div>

        <p class="footnote">Ingen følsomme finansdata. Demo gemmer lokalt.</p>
      </section>

      <section class="card hidden" data-screen="lead2">
        <div class="kicker">Plan</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackLead2Top" type="button">Tilbage</button></div>
        <h2>Hvordan vil du kontaktes?</h2>
        <p class="muted">Valgfrit. Du kan springe over og se preview.</p>

        <div class="grid2">
          <div class="field"><label for="lastName">Efternavn (valgfrit)</label><input id="lastName" type="text" placeholder="Efternavn"></div>
          <div class="field"><label for="phone">Telefon (valgfrit)</label><input id="phone" type="tel" placeholder="+45 ..."></div>
        </div>

        <div class="field">
          <label for="pref">Kontaktpræference</label>
          <select id="pref">
            <option value="email">Email</option>
            <option value="ring">Ring</option>
            <option value="booking">Booking</option>
          </select>
        </div>

        <div class="btnRowOne">
          <button class="primary" id="btnPreview" type="button">Se hvad der sendes</button>
          <button class="secondaryLink" id="btnBackLead2" type="button">Tilbage</button>
        </div>
      </section>


      <section class="card hidden" data-screen="preview">
        <div class="kicker">Preview</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackPreviewTop" type="button">Tilbage</button></div>
</div>
          <div class="progressTxt">Trin 5/5</div>
        </div>
    
        <h2>Det her sendes</h2>
        <p class="muted">Demo gemmer lokalt (ingen afsendelse til tredjepart).</p>

        <div class="preview">
          <div class="previewRow"><div>Navn</div><div class="strong" id="pvName">—</div></div>
          <div class="previewRow"><div>Kontakt</div><div class="strong" id="pvContact">—</div></div>
          <div class="previewRow"><div>Intent</div><div class="strong" id="pvIntent">—</div></div>
          <div class="previewRow"><div>Mulig pensionsalder</div><div class="strong" id="pvPossible">—</div></div>
          <div class="previewRow"><div>Tidsgevinst</div><div class="strong" id="pvDelta">—</div></div>
        </div>

        <details style="margin-top:12px">
          <summary class="muted">Se teknisk payload</summary>
          <pre class="payload" id="payloadBox" style="margin-top:10px">{}</pre>
        </details>

        <div class="row">
          <button type="button" class="primary" id="btnSubmit">Send (demo)</button>
          <button type="button" class="ghost" id="btnBackFromPreview">Tilbage</button>
        </div>
      </section>

      <section class="card hidden" data-screen="thanks">
        <div class="kicker">Tak</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackThanksTop" type="button">Tilbage</button></div>
        <h2>Din henvendelse er registreret</h2>
        <p class="muted">I en rigtig version vil en rådgiver kontakte dig indenfor en aftalt tidsramme.</p>
        <div class="row">
          <button type="button" class="primary" id="btnRestart">Start forfra</button>
          <button type="button" class="ghost" id="btnAdminGo">Se admin</button>
        </div>
      </section>

      <section class="card hidden" data-screen="admin">
        <div class="kicker">Admin</div>
        <div class="row between" style="margin-top:6px;margin-bottom:2px"><div></div><button class="ghost smallBtn" id="btnBackAdminTop" type="button">Tilbage</button></div>
        <h2>Leads (demo)</h2>
        <p class="muted">Gemmes i browserens localStorage.</p>
        <div class="row">
          <button type="button" class="ghost" id="btnClear">Slet alle leads</button>
          <button type="button" class="ghost" id="btnBackStart">Til start</button>
        </div>
        <div class="adminList" id="adminList"></div>
      </section>

      <div class="nav">
        <div class="navInner">
          <button type="button" class="navBtn" id="navResult">Resultat</button>
          <button type="button" class="navBtn" id="navAdjust">Justér</button>
          <button type="button" class="navBtn" id="navContact">Plan</button>
        </div>
      </div>
    </main>

    <footer class="bottombar">
      <div class="muted small">Simulering · ikke rådgivning</div>
      <div class="muted small" id="buildStamp"></div>
    </footer>
  </div>

  <script>
function goBackFrom(name){
  const map={
    inspiration:'start',
    setup:'inspiration',
    hero:'setup',
    adjust:'hero',
    choices:'adjust',
    assumptions:'hero',
    gain:'hero',
    lead1:'gain',
    lead2:'lead1',
    preview:'lead2',
    thanks:'gain',
    admin:'gain'
  };
  const target = map[name] || 'start';
  if(target==='start'){ softHome(); return; }
  // render as needed
  if(target==='setup'){ hydrateSetupInputs(); renderSetupPreview(); }
  if(target==='hero'){ renderHero(); }
  if(target==='adjust'){ renderAdjust(); }
  if(target==='choices'){ renderChoices(); }
  if(target==='gain'){ renderGain(); }
  if(target==='inspiration'){ renderInspiration(); }
  screen(target);
}

function setProgress(step){
  const bar=document.getElementById('progressBar');
  const lbl=document.getElementById('progressLabel');
  const pct=Math.max(1,Math.min(5,step))/5;
  if(bar) bar.style.width = Math.round(pct*100) + '%';
  if(lbl) lbl.textContent = `Trin ${step}/5`;
}

function updateTimeRing(deltaYears){
  const ring=document.getElementById('timeRing');
  const label=document.getElementById('ringLabel');
  if(!ring||!label) return;
  const maxYears=15;
  const pct=Math.min(1,deltaYears/maxYears);
  const deg=Math.floor(pct*360);
  ring.style.background=`conic-gradient(var(--blue) ${deg}deg,#e8eefc ${deg}deg)`;
  label.textContent=Math.round(pct*100)+"%";
}




    const BUILD_ID = "PO-V9.1-2026-02-19-7D60A4";

    // Polyfill for older iOS Safari
    if(!String.prototype.replaceAll){
      // minimal replaceAll polyfill
      String.prototype.replaceAll = function(search, replacement){
        const target = String(this);
        return target.split(search).join(replacement);
      };
    }

    const $ = (s)=>document.querySelector(s);
    const $$ = (s)=>Array.from(document.querySelectorAll(s));

    function on(id, evt, fn, opts){
      const el = typeof id === 'string' ? $('#'+id) : id;
      if(!el) return false;
      el.addEventListener(evt, fn, opts);
      return true;
    }
    function setText(id, txt){
      const el = typeof id === 'string' ? $('#'+id) : id;
      if(el) el.textContent = txt;
    }
    

    const state = {
      profile: { age: null },
      capital: { current_savings: 0 },
      assumptions: { normal_pension_age: 67, return_rate: 0.07, payout_target_monthly: 20000 },
      scenario: { extra_saving_manual: 0, selected_choices: new Set() },
      momentum: { last_seen_at: null, last_possible_age: null },
      engagement: { adjusted:false, choice_clicked:false },
      meta: { assumptions_version: 1 },
      inspiration: { chosen_monthly: 0 },
      ui: { choices_offset: 0 }
    };

    
    window.__po_last_error = null;
    window.__po_error_log = [];
    function logError(kind, message, extra){
      const item = { ts: new Date().toISOString(), kind, message: String(message||''), extra: extra||null };
      window.__po_last_error = item;
      window.__po_error_log.push(item);
      if(window.__po_error_log.length > 25) window.__po_error_log.shift();
      try{ localStorage.setItem('po_last_error', JSON.stringify(item)); }catch{}
      const fab = $('#debugFab');
      if(fab) fab.classList.add('show');
    }
    window.addEventListener('error', (e)=>{
      logError('error', e?.message || 'Unknown error', { file: e?.filename, line: e?.lineno, col: e?.colno });
    });
    window.addEventListener('unhandledrejection', (e)=>{
      logError('promise', e?.reason?.message || e?.reason || 'Unhandled rejection', null);
    });

    
function approxWorkdaysFromYears(y){
  const days = Math.max(0, Math.floor(y*365));
  const workdays = Math.floor(days * 5/7);
  return { days, workdays };
}
function fmtWorkdays(y){
  const { days, workdays } = approxWorkdaysFromYears(y);
  if(days < 60) return `≈ ${days} dage`;
  if(days < 540) return `≈ ${Math.floor(days/30)} måneder`;
  return `≈ ${workdays} hverdage`;
}
function validateEmail(s){
  const v = String(s||'').trim();
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
}
function stableHash(str){
  let h = 0x811c9dc5;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = (h * 0x01000193) >>> 0;
  }
  return ('0000000' + h.toString(16)).slice(-8);
}
function setNavReady(){
  const nav = document.querySelector('.nav');
  if(!nav) return;
  nav.classList.toggle('ready', canNavigateMain());
}
let __lead_last_submit_at = 0;

function toast(msg){

      const t = $('#toast');
      t.textContent = msg;
      t.classList.add('show');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(()=>t.classList.remove('show'), 2200);
    }

    function openModal(title, bodyHtml, dots=0, dotOn=0){
      $('#modalTitle').textContent = title;
      $('#modalBody').innerHTML = bodyHtml;
      const dotsWrap = $('#modalDots');
      dotsWrap.innerHTML = '';
      if(dots>1){
        for(let i=0;i<dots;i++){
          const d=document.createElement('div');
          d.className='dotStep' + (i===dotOn ? ' on':'');
          dotsWrap.appendChild(d);
        }
        dotsWrap.style.display='flex';
      } else {
        dotsWrap.style.display='none';
      }
      $('#modal').classList.add('show');
    }
    function closeModal(){ $('#modal').classList.remove('show'); }
    function encodeState(){
      const payload = {
        v: state.meta.assumptions_version,
        a: state.profile.age,
        s: state.capital.current_savings,
        e: state.scenario.extra_saving_manual,
        c: Array.from(state.scenario.selected_choices),
        r: state.assumptions.return_rate,
        p: state.assumptions.payout_target_monthly
      };
      const json = JSON.stringify(payload);
      return btoa(unescape(encodeURIComponent(json))).replaceAll('=','');
    }
    function escapeHtml(s){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    
    function decodeState(token){
      try{
        const json = decodeURIComponent(escape(atob(token)));
        const o = JSON.parse(json);
        return o;
      }catch{ return null; }
    }
    function applyDecoded(o){
      if(!o) return false;
      if(Number.isFinite(o.a)) state.profile.age = o.a;
      if(Number.isFinite(o.s)) state.capital.current_savings = Math.max(0,o.s);
      if(Number.isFinite(o.e)) state.scenario.extra_saving_manual = Math.max(0,o.e);
      state.scenario.selected_choices = new Set(Array.isArray(o.c)? o.c : []);
      if(Number.isFinite(o.r)) state.assumptions.return_rate = o.r;
      if(Number.isFinite(o.p)) state.assumptions.payout_target_monthly = o.p;
      return true;
    }

    function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
    function fmtInt(n){ return new Intl.NumberFormat('da-DK',{maximumFractionDigits:0}).format(n); }
    function pulse(el){ if(!el) return; el.classList.remove('pulse'); void el.offsetWidth; el.classList.add('pulse'); }

    function splitYearsToYmConservative(yearsFloat){
      const totalMonths = Math.max(0, Math.floor(yearsFloat * 12 + 1e-9));
      const y = Math.floor(totalMonths / 12);
      const m = totalMonths % 12;
      return { y, m, totalMonths };
    }
    function fmtAgeConservative(ageFloat){
      const { y, m } = splitYearsToYmConservative(ageFloat);
      return m===0 ? `${y} år` : `${y} år ${m} mdr`;
    }
    function fmtDeltaConservative(deltaYears){
      const days = Math.max(0, Math.floor(deltaYears * 365 + 1e-9));
      if(days < 45) return `${days} dage`;
      const months = Math.max(0, Math.floor(deltaYears * 12 + 1e-9));
      if(days <= 540) return `${months} mdr`;
      const y = Math.floor(months/12), m = months%12;
      return m===0 ? `${y} år` : `${y} år ${m} mdr`;
    }

    function screen(name){
      window.__po_screen = name;
      const stepMap={ start:1, inspiration:2, setup:3, hero:4, adjust:4, choices:4, assumptions:4, gain:5, lead1:5, lead2:5, preview:5, thanks:5, admin:5 };
      setProgress(stepMap[name]||1);
      $$('[data-screen]').forEach(el=>el.classList.toggle('hidden', el.getAttribute('data-screen')!==name));
      setNavActive(name);
      window.scrollTo(0,0);
    }
    function setNavActive(screenName){
      const map = { hero:'navResult', momentum:'navResult', gain:'navContact', adjust:'navAdjust', choices:'navAdjust', assumptions:'navAdjust', lead1:'navContact', lead2:'navContact', preview:'navContact' };
      const active = map[screenName] || null;
      ['navResult','navAdjust','navContact'].forEach(id=>$('#'+id).classList.toggle('active', id===active));
    }
    function canNavigateMain(){ return Number.isFinite(state.profile.age) && state.profile.age !== null; }

    const CHOICES = [
      { id:'stream', level:1, difficulty:'Let', title:'1 streamingtjeneste mindre', meta:'abonnement', addMonthly:129 },
      { id:'soda', level:1, difficulty:'Let', title:'1 sodavand mindre fra tanken', meta:'små vaner', addMonthly:300 },
      { id:'coffee', level:1, difficulty:'Let', title:'1 kaffe mindre fra kaffebar', meta:'ca. 20 kr/dag', addMonthly:600 },
      { id:'subscriptions', level:1, difficulty:'Let', title:'Ryd op i abonnementer', meta:'samlet effekt', addMonthly:500 },
      { id:'takeaway', level:1, difficulty:'Mellem', title:'1 take-away mindre om ugen', meta:'små vaner', addMonthly:800 },
      { id:'food', level:1, difficulty:'Mellem', title:'Madbudget justering', meta:'struktur frem for afsavn', addMonthly:1000 },
      { id:'mobile', level:2, difficulty:'Let', title:'Billigere mobil/internet', meta:'prisplan', addMonthly:300 },
      { id:'insurance', level:2, difficulty:'Mellem', title:'Genforhandle forsikringer', meta:'typisk ved gennemgang', addMonthly:800 },
      { id:'transport', level:2, difficulty:'Mellem', title:'Transportjustering', meta:'pendler/vaner', addMonthly:1200 },
      { id:'raise_partial', level:2, difficulty:'Stor', title:'Del af lønforhøjelse til opsparing', meta:'strukturel', addMonthly:2000 },
      { id:'side', level:3, difficulty:'Stor', title:'Sideindtægt til opsparing', meta:'små projekter', addMonthly:3000 },
      { id:'raise', level:3, difficulty:'Stor', title:'Lønforhøjelse direkte til opsparing', meta:'når du får den', addMonthly:3000 },
      { id:'housing', level:3, difficulty:'Stor', title:'Bolig/struktur-justering', meta:'større beslutning', addMonthly:4000 },
    ];

function choiceDifficulty(c){
  if(c.addMonthly <= 800) return { key:'easy', label:'Let' };
  if(c.addMonthly <= 2000) return { key:'med', label:'Mellem' };
  return { key:'hard', label:'Stor' };
}


    function selectedSum(){
      let sum = 0;
      for(const id of state.scenario.selected_choices){
        const c = CHOICES.find(x=>x.id===id);
        if(c) sum += c.addMonthly;
      }
      return sum;
    }
    function totalExtraMonthly(){ return Math.max(0, state.scenario.extra_saving_manual) + selectedSum(); }

    function compute(extraMonthlyOverride=null, currentSavingsOverride=null){
      const age = state.profile.age;
      const normal = state.assumptions.normal_pension_age;
      const r = state.assumptions.return_rate;
      const payout = state.assumptions.payout_target_monthly;

      const extraMonthly = (extraMonthlyOverride===null) ? totalExtraMonthly() : Math.max(0, extraMonthlyOverride);
      const currentSavings = (currentSavingsOverride===null) ? Math.max(0, state.capital.current_savings) : Math.max(0, currentSavingsOverride);

      const yearsToNormal = Math.max(0, normal - age);

      const extraAnnual = extraMonthly * 12;
      const returnFactor = 0.85 + (r - 0.06) * 2.5;
      const payoutFactor = 20000 / Math.max(12000, payout);

      const rawFlow = Math.log1p(extraAnnual / 10000) * 2.8;
      const rawStock = Math.log1p(currentSavings / 250000) * 0.55;

      const horizonFactor = Math.sqrt(Math.max(0.5, yearsToNormal / 20));
      let yearsBought = (rawFlow + rawStock) * returnFactor * payoutFactor * horizonFactor;

      const capA = 10;
      const capB = yearsToNormal * 0.40;
      yearsBought = Math.min(yearsBought, capA, capB);

      const minAge = Math.max(18, normal - 15);
      const possible = clamp(normal - yearsBought, minAge, normal);
      const deltaYears = Math.max(0, normal - possible);

      return { possible, normal, deltaYears, minAge, extraMonthly, currentSavings, r, payout };
    }

    function safeParseInt(v){ const n = parseInt(v,10); return Number.isFinite(n) ? n : null; }

    function ensureAgeFromStart(){
      const a = safeParseInt($('#age').value);
      if(!(Number.isFinite(a) && a>=18 && a<=70)) return false;
      state.profile.age = a;
      return true;
    }

    function hydrateSetupInputs(){
      $('#extraMonthly').value = state.scenario.extra_saving_manual ? state.scenario.extra_saving_manual : '';
      $('#currentSavings').value = state.capital.current_savings ? state.capital.current_savings : '';
      $('#extraManual').value = state.scenario.extra_saving_manual ? state.scenario.extra_saving_manual : '';
      $('#extraRange').value = clamp(state.scenario.extra_saving_manual,0,5000);
    }

    function renderSetupPreview(){
      const extra = safeParseInt($('#extraMonthly').value);
      const s = safeParseInt($('#currentSavings').value);
      state.scenario.extra_saving_manual = (extra!==null && extra>=0) ? extra : 0;
      state.capital.current_savings = (s!==null && s>=0) ? s : 0;
      const res = compute();
      $('#setupPossible').textContent = fmtAgeConservative(res.possible);
      $('#setupDelta').textContent = fmtDeltaConservative(res.deltaYears);
      $('#setupTotalExtra').textContent = `${fmtInt(res.extraMonthly)} kr./md`;
    }

    function renderHero(){
      const res = compute();
      $('#heroPossible').textContent = fmtAgeConservative(res.possible); updateTimeRing(res.deltaYears);
      $('#heroNormal').textContent = fmtAgeConservative(res.normal);
      $('#pillDelta').textContent = res.deltaYears>0 ? `+ ${fmtDeltaConservative(res.deltaYears)}` : 'Ingen gevinst endnu';
      $('#heroPayout').textContent = `${fmtInt(res.payout)} kr./md`;
      $('#heroReturn').textContent = `${Math.round(res.r*100)}%`;
      $('#heroTotalExtra').textContent = `${fmtInt(res.extraMonthly)} kr./md`;
      $('#heroHint').textContent = res.deltaYears>0 ? 'Du har skabt tid. Justér for at se hvad der er realistisk.' : 'Tilføj et beløb eller vælg små valg for at skabe tid.';

      $('#valNormal').textContent = fmtAgeConservative(res.normal);
      $('#valPossible').textContent = fmtAgeConservative(res.possible);
      const human = $('#heroHumanTime');
      if(human){
        human.textContent = res.deltaYears>0 ? `${fmtWorkdays(res.deltaYears)} tidligere (konservativt estimat).` : 'Vælg et beløb eller et lille valg for at se potentiel gevinst.';
      }

      const span = res.normal - res.minAge || 1;
      const wPossible = ((res.possible - res.minAge)/span)*100;
      $('#barNormal').style.width = `100%`;
      $('#barPossible').style.width = `${clamp(wPossible,0,100)}%`;

      pulse($('#heroPossible')); pulse($('#pillDelta'));
    }

    function renderAdjust(){
      const res = compute();
      $('#extraLbl').textContent = fmtInt(state.scenario.extra_saving_manual);
      $('#adjPossible').textContent = fmtAgeConservative(res.possible);
      $('#adjDelta').textContent = fmtDeltaConservative(res.deltaYears);
      $('#adjChoices').textContent = String(state.scenario.selected_choices.size);
      $('#adjTotalExtra').textContent = `${fmtInt(res.extraMonthly)} kr./md`;
    }

    function renderMomentum(){
      const res = compute();
      const last = state.momentum.last_seen_at;
      const now = new Date();
      $('#mLast').textContent = last ? new Date(last).toLocaleString('da-DK') : '—';

      const lastPossible = state.momentum.last_possible_age;
      let text = '—';
      if(lastPossible != null){
        const diff = Math.max(0, lastPossible - res.possible);
        text = diff > 1e-6 ? `+ ${fmtDeltaConservative(diff)}` : 'Uændret';
      }
      $('#mDelta').textContent = text;

      state.momentum.last_seen_at = now.toISOString();
      state.momentum.last_possible_age = res.possible;
      localStorage.setItem('po_momentum', JSON.stringify(state.momentum));
    }

    function renderGain(){
      const res = compute();
      $('#gainPill').textContent = `+ ${fmtDeltaConservative(res.deltaYears)}`;
      $('#gainPossible').textContent = fmtAgeConservative(res.possible);
      $('#gainNormal').textContent = fmtAgeConservative(res.normal);
      $('#gainSavings').textContent = `${fmtInt(state.capital.current_savings)} kr.`;
      $('#gainExtraManual').textContent = `${fmtInt(state.scenario.extra_saving_manual)} kr./md`;
      $('#gainChoices').textContent = `${state.scenario.selected_choices.size} valg`;
      $('#gainTotalExtra').textContent = `${fmtInt(totalExtraMonthly())} kr./md`;
      renderMomentum();
      pulse($('#gainPill'));
    
const ok = (state.engagement.adjusted || state.engagement.choice_clicked);
const note = $('#leadGateNote');
const btn = $('#btnLead');
if(note){ note.textContent = ok ? 'Klar: du har lavet mindst én realistisk justering.' : 'For at få en plan: lav mindst én justering eller vælg et lille valg.'; }
if(btn){ btn.classList.toggle('disabled', !ok); }

    }


    
function tierFromMonthly(extra){
  if(extra <= 2500) return 1;
  if(extra <= 5000) return 2;
  return 3;
}
function choicesFiltered(){
  const currentExtra = totalExtraMonthly();
  const tier = tierFromMonthly(currentExtra);
  const pool = CHOICES.filter(c=>c.level===tier);
  const age = state.profile.age ?? 35;
  const young = age < 32;
  const priority = young
    ? ['stream','coffee','takeaway','subscriptions','food','insurance','mobile','transport','raise_partial','raise','side','housing']
    : ['insurance','subscriptions','food','mobile','transport','raise_partial','raise','side','housing','stream','coffee','takeaway'];
  const ordered = [];
  priority.forEach(id=>{ const it = pool.find(x=>x.id===id); if(it) ordered.push(it); });
  pool.forEach(it=>{ if(!ordered.includes(it)) ordered.push(it); });
  return ordered;
}

    function renderChoices(){
      const res = compute();
      $('#choicesPossible').textContent = fmtAgeConservative(res.possible);
      $('#choicesDelta').textContent = fmtDeltaConservative(res.deltaYears);
      $('#choicesTotalExtra').textContent = `${fmtInt(res.extraMonthly)} kr./md`;

      const list = $('#choiceList');
      list.innerHTML = '';

      const items = choicesFiltered();

      const tierHint = $('#tierHint');
      if(tierHint){
        const t = tierFromMonthly(totalExtraMonthly());
        const msg = t===1 ? 'Niveau: 0–2.500 kr./md · små justeringer i hverdagen'
                 : t===2 ? 'Niveau: 2.500–5.000 kr./md · strukturelle besparelser'
                 : 'Niveau: 5.000+ kr./md · større beslutninger / ekstra indtægt';
        tierHint.style.display = 'block';
        tierHint.innerHTML = `<div class="hintTitle">Inspiration</div><div class="muted small">${msg}. Vælg 1–3 forslag og se effekten.</div>`;
      }

      const start = clamp(state.ui.choices_offset, 0, Math.max(0, items.length-1));
      const slice = items.slice(start, start+3);

      const baseRes = compute();
      const baseDelta = baseRes.deltaYears;

      slice.forEach(item=>{
        const isOn = state.scenario.selected_choices.has(item.id);
        let label = '—';
        if(!isOn){
          const resOn = compute(totalExtraMonthly() + item.addMonthly, null);
          const marginal = Math.max(0, resOn.deltaYears - baseDelta);
          if(marginal*365 < 10){ return; }
          label = `+ ${fmtDeltaConservative(marginal)}`;
        } else {
          const resOff = compute(totalExtraMonthly() - item.addMonthly, null);
          const loss = Math.max(0, baseDelta - resOff.deltaYears);
          label = `− ${fmtDeltaConservative(loss)}`;
        }

        const el = document.createElement('div');
        el.className = 'choiceItem';
        el.innerHTML = `
          <div>
            <div class="choiceTitle">${item.title}</div>
            <div class="choiceMeta">${item.meta} · ${fmtInt(item.addMonthly)} kr./md · <strong>${item.difficulty}</strong></div>
          </div>
          <div class="toggle">
            <span class="pill ${isOn ? 'good':''}">${label}</span>
            <button type="button" class="switchBtn" data-choice="${item.id}" aria-label="Toggle">
              <div class="switch ${isOn ? 'on':''}">
                <div class="knob"></div>
              </div>
            </button>
          </div>
        `;
        list.appendChild(el);
      });

      const handler = (btn, e)=>{
        if(e){ e.preventDefault?.(); e.stopPropagation?.(); }
        const id = btn.getAttribute('data-choice');
        if(state.scenario.selected_choices.has(id)) state.scenario.selected_choices.delete(id);
        else state.scenario.selected_choices.add(id);
        renderSetupPreview(); renderHero(); renderAdjust(); renderChoices(); renderGain();
      };

      const total = items.length;
      const shownTo = Math.min(total, start+3);
      const remaining = Math.max(0, total - shownTo);
      const btnMore = $('#btnMoreChoices');
      if(btnMore) btnMore.textContent = remaining>0 ? `Vis 3 flere (${remaining} tilbage)` : 'Start forfra (valg)';

      list.querySelectorAll('[data-choice]').forEach(btn=>{
        btn.addEventListener('click', (e)=>handler(btn,e), {passive:false});
        btn.addEventListener('touchstart', (e)=>handler(btn,e), {passive:false});
      });
    }

    function moreChoices(){
      const items = choicesFiltered();

      const tierHint = $('#tierHint');
      if(tierHint){
        const t = tierFromMonthly(totalExtraMonthly());
        const msg = t===1 ? 'Niveau: 0–2.500 kr./md · små justeringer i hverdagen'
                 : t===2 ? 'Niveau: 2.500–5.000 kr./md · strukturelle besparelser'
                 : 'Niveau: 5.000+ kr./md · større beslutninger / ekstra indtægt';
        tierHint.style.display = 'block';
        tierHint.innerHTML = `<div class="hintTitle">Inspiration</div><div class="muted small">${msg}. Vælg 1–3 forslag og se effekten.</div>`;
      }

      const next = state.ui.choices_offset + 3;
      state.ui.choices_offset = (next >= items.length) ? 0 : next;
      renderChoices();
    }

    function leadsGet(){ try { return JSON.parse(localStorage.getItem('po_leads')||'[]'); } catch { return []; } }
    function leadsSet(arr){ localStorage.setItem('po_leads', JSON.stringify(arr)); }

    function buildPayload(){
      const res = compute();
      return {
        contact: {
          first_name: ($('#firstName').value||'').trim(),
          last_name:  ($('#lastName')?.value||'').trim(),
          email_or_phone: ($('#email').value||'').trim(),
          phone:      ($('#phone')?.value||'').trim(),
          contact_preference: ($('#pref')?.value||'ring')
        },
        intent: $('#intent').value,
        profile: { age: state.profile.age },
        capital: { current_savings: state.capital.current_savings },
        assumptions: {
          assumptions_version: state.meta.assumptions_version,
          normal_pension_age: state.assumptions.normal_pension_age,
          return_rate: state.assumptions.return_rate,
          payout_target_monthly: state.assumptions.payout_target_monthly
        },
        scenario_state: {
          extra_saving_manual_monthly: state.scenario.extra_saving_manual,
          selected_choices: Array.from(state.scenario.selected_choices),
          total_extra_monthly: totalExtraMonthly()
        },
        result: {
          possible_pension_age: res.possible,
          normal_pension_age: res.normal,
          delta_time: fmtDeltaConservative(res.deltaYears)
        },
        timestamp: new Date().toISOString(),
        mode: "demo_localstorage",
        integrity: {
          state_hash: stableHash(JSON.stringify({a:state.profile.age,s:state.capital.current_savings,e:state.scenario.extra_saving_manual,c:Array.from(state.scenario.selected_choices),r:state.assumptions.return_rate,p:state.assumptions.payout_target_monthly,v:state.meta.assumptions_version})),
          result_hash: stableHash(JSON.stringify(res))
        },
        build_id: BUILD_ID
      };
    }

    function renderPreview(){
      const p = buildPayload();
      $('#pvName').textContent = (p.contact.first_name || '—') + (p.contact.last_name ? ' ' + p.contact.last_name : '');
      $('#pvContact').textContent = p.contact.email_or_phone || '—';
      $('#pvIntent').textContent = p.intent.replaceAll('_',' ');
      $('#pvPossible').textContent = fmtAgeConservative(p.result.possible_pension_age);
      $('#pvDelta').textContent = p.result.delta_time;
      $('#payloadBox').textContent = JSON.stringify(p, null, 2);
    }

    function renderAdmin(){
      const root = $('#adminList');
      const leads = leadsGet().slice().reverse();
      if(!leads.length){
        root.innerHTML = `<div class="leadCard"><div class="muted">Ingen leads endnu.</div></div>`;
        return;
      }
      root.innerHTML = '';
      leads.forEach(p=>{
        const d = new Date(p.timestamp);
        const el = document.createElement('div');
        el.className='leadCard';
        el.innerHTML = `
          <div class="leadHead">
            <div class="leadName">${(p.contact.first_name||'—')} ${(p.contact.last_name||'')}</div>
            <div class="leadTime">${d.toLocaleString('da-DK')}</div>
          </div>
          <div class="small" style="margin-top:8px;color:#2a3b57">
            <div><strong>Intent:</strong> ${p.intent}</div>
            <div><strong>Alder:</strong> ${p.profile.age} · <strong>Opsparing:</strong> ${fmtInt(p.capital.current_savings)} kr.</div>
            <div><strong>Mulig:</strong> ${fmtAgeConservative(p.result.possible_pension_age)} · <strong>Normal:</strong> ${fmtAgeConservative(p.result.normal_pension_age)} · <strong>Gevinst:</strong> ${p.result.delta_time}</div>
            <div><strong>Ekstra opsparing:</strong> ${fmtInt(p.scenario_state.total_extra_monthly)} kr./md · <strong>Valg:</strong> ${(p.scenario_state.selected_choices||[]).length}</div>
            <div><strong>Build:</strong> ${p.build_id || '—'}</div>
          </div>
          <details style="margin-top:10px">
            <summary class="muted">Se payload</summary>
            <pre class="payload" style="margin-top:10px">${JSON.stringify(p,null,2)}</pre>
          </details>
        `;
        root.appendChild(el);
      });
    }

    function softHome(){
      if(state.profile.age !== null) $('#age').value = state.profile.age;
      setNavReady();
      screen('start');

// V7: long-press on brand opens debug (even if no error)
(function longPressDebug(){
  const brand = document.getElementById('btnHome');
  if(!brand) return;
  let t=null;
  const open = ()=>{
    let item = window.__po_last_error;
    if(!item){
      try{ item = JSON.parse(localStorage.getItem('po_last_error')||'null'); }catch{ item = null; }
    }
    const snap = {
      build: BUILD_ID,
      screen: window.__po_screen || null,
      age: state?.profile?.age ?? null,
      savings: state?.capital?.current_savings ?? null,
      extra: state?.scenario?.extra_saving_manual ?? null,
      choices: Array.from(state?.scenario?.selected_choices||[])
    };
    const body =
      `<p class="muted">Build: <strong>${BUILD_ID}</strong></p>` +
      `<p class="muted">Seneste fejl (hvis nogen):</p>` +
      `<div class="debugPre">${escapeHtml(JSON.stringify(item,null,2) || 'null')}</div>` +
      `<p class="muted" style="margin-top:10px">State snapshot:</p>` +
      `<div class="debugPre">${escapeHtml(JSON.stringify(snap,null,2))}</div>`;
    openModal('Debug', body);
  };
  brand.addEventListener('touchstart', ()=>{ t=setTimeout(open, 700); }, {passive:true});
  brand.addEventListener('touchend', ()=>{ if(t){clearTimeout(t); t=null;} }, {passive:true});
})();

    }

    function wireNav(){
      on('navResult','click', ()=>{
        if(!canNavigateMain()) return softHome();
        renderHero(); screen('hero');
      });
      on('navAdjust','click', ()=>{
        if(!canNavigateMain()) return softHome();
        renderAdjust(); screen('adjust');
      });
      on('navContact','click', ()=>{
        if(!canNavigateMain()) return softHome();
        renderGain(); screen('gain');
      });
    }

    function init(){
      setText('buildStamp', `${BUILD_ID}`);

      try{
        const m = JSON.parse(localStorage.getItem('po_momentum')||'null');
        if(m) state.momentum = m;
      }catch{}

      $('#buildStamp').textContent = `Build: ${new Date().toLocaleDateString('da-DK')} · ${BUILD_ID}`;
      setText('buildPill', `Build: ${BUILD_ID}`);
      // Debug button
      on('debugFab','click', ()=>{
        const last = window.__po_last_error;
        let body = '';
        if(!last){
          try{ const stored = JSON.parse(localStorage.getItem('po_last_error')||'null'); if(stored) { window.__po_last_error = stored; } }catch{}
        }
        const item = window.__po_last_error;
        if(!item){
          body = `<p class="muted">Ingen registrerede fejl i denne session.</p>`;
        } else {
          body = `<p><strong>Seneste fejl</strong></p>
                  <div class="debugPre">${escapeHtml(JSON.stringify(item,null,2))}</div>
                  <p class="muted" style="margin-top:10px">Tip: tag et screenshot og send det.</p>`;
        }
        openModal('Debug', body);
      });


      // Load shared plan from URL
      try{
        const params = new URLSearchParams(location.search);
        const t = params.get('s');
        if(t){
          const o = decodeState(t);
          if(applyDecoded(o)){
            $('#age').value = state.profile.age ?? '';
            hydrateSetupInputs();
            renderSetupPreview();
            renderHero();
            toast('Plan indlæst fra link.');
          }
        }
      }catch{}

      on('modalClose','click', closeModal);
      on('modal','click', (e)=>{ if(e.target && e.target.id==='modal') closeModal(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

      on('btnWhatIsTime','click', ()=>{
        openModal('Hvad betyder “tid”?',
          `<p><strong>Tid</strong> er hvor mange måneder/år tidligere din økonomi <em>muligvis</em> kan bære pension.</p>
           <ul>
             <li>Du ser en konservativ simulering.</li>
             <li>Du kan justere beløb og små valg.</li>
             <li>Resultatet er et overblik – ikke rådgivning.</li>
           </ul>`);
      });

      on('btnTutorial','click', ()=>{
        openModal('Sådan bruger du appen',
          `<ol>
             <li>Indtast alder</li>
             <li>Tilføj realistisk beløb + kontant opsparing</li>
             <li>Se resultat i tid</li>
             <li>Justér og vælg små valg</li>
             <li>Gem plan eller kontakt</li>
           </ol>`, 5, 0);
      });

      on('btnHome','click', softHome);
      on('btnAdminTop','click', ()=>{ renderAdmin(); screen('admin'); });

      on('btnDemo','click', ()=>{ const a=$('#age'); if(a) a.value=38; const e=$('#errAge'); if(e) e.classList.remove('show'); });
      on('age','input', ()=>{ const e=$('#errAge'); if(e) e.classList.remove('show'); });

      on('btnContinue','click', ()=>{
        if(!ensureAgeFromStart()){ $('#errAge').classList.add('show'); toast('Udfyld alder for at fortsætte.'); return; }
        $('#errAge').classList.remove('show');
        renderInspiration();
        screen('inspiration');
      });

      on('btnBackToStart','click', ()=>screen('start'));

      ['extraMonthly','currentSavings'].forEach(id=>{
        const el = $('#'+id);
        el && el.addEventListener('input', renderSetupPreview);
        el && el.addEventListener('change', renderSetupPreview);
      });

      on('btnHelpFindMoney','click', ()=>{
        state.ui.choices_offset = 0;
        renderHero();
        renderChoices();
        toast('Vælg et par små valg og se effekten.');
        screen('choices');
      });

      on('btnSeeResult','click', ()=>{ renderHero(); screen('hero'); });

      on('btnAdjust','click', ()=>{ hydrateSetupInputs(); renderAdjust(); screen('adjust'); });
      on('btnChoices','click', ()=>{ state.ui.choices_offset = 0; renderChoices(); screen('choices'); });
      on('btnAssumptions','click', ()=>{
        const payout = state.assumptions.payout_target_monthly;
        const known = ['18000','20000','22000','25000'];
        if(known.includes(String(payout))){
          $('#payout').value = String(payout);
          $('#payoutCustomWrap').classList.add('hidden');
        } else {
          $('#payout').value = 'custom';
          $('#payoutCustomWrap').classList.remove('hidden');
          $('#payoutCustom').value = payout;
        }
        $('#returnRate').value = String(state.assumptions.return_rate);
        screen('assumptions');
      });

      on('btnBackFromAdjust','click', ()=>{ renderHero(); screen('hero'); });
      on('btnToChoicesFromAdjust','click', ()=>{ state.ui.choices_offset = 0; renderChoices(); screen('choices'); });
      on('btnToGainFromAdjust','click', ()=>{ renderGain(); screen('gain'); });

      on('extraRange','input', (e)=>{
        state.scenario.extra_saving_manual = parseInt(e.target.value,10) || 0;
        state.engagement.adjusted = state.scenario.extra_saving_manual>0 || (state.scenario.selected_choices.size>0);
        $('#extraManual').value = state.scenario.extra_saving_manual ? state.scenario.extra_saving_manual : '';
        $('#extraMonthly').value = state.scenario.extra_saving_manual ? state.scenario.extra_saving_manual : '';
        renderSetupPreview(); renderHero(); renderAdjust(); renderChoices(); renderGain();
      });
      on('extraManual','input', (e)=>{
        const v = Math.max(0, parseInt(e.target.value,10) || 0);
        state.scenario.extra_saving_manual = v;
        state.engagement.adjusted = state.scenario.extra_saving_manual>0 || (state.scenario.selected_choices.size>0);
        $('#extraRange').value = clamp(v,0,5000);
        $('#extraMonthly').value = v ? v : '';
        renderSetupPreview(); renderHero(); renderAdjust(); renderChoices(); renderGain();
      });

      on('btnBackFromChoices','click', ()=>{ renderHero(); screen('hero'); });
      on('btnMoreChoices','click', moreChoices);
      on('btnToGain','click', ()=>{ renderGain(); screen('gain'); });

      on('btnBackFromGain','click', ()=>{ state.ui.choices_offset = 0; renderChoices(); screen('choices'); });
      on('btnSavePlan','click', async ()=>{
        if(!canNavigateMain()) return toast('Udfyld alder først.');
        const token = encodeState();
        const url = location.origin + location.pathname + '?s=' + token;
        try{
          await navigator.clipboard.writeText(url);
          toast('Link kopieret.');
        }catch{
          toast('Kunne ikke kopiere automatisk.');
        }
        openModal('Gem din plan (link)', `<p class="muted">Del eller gem dette link. Det indeholder kun dine indtastninger.</p><div class="preview" style="margin-top:10px"><div class="previewRow"><div>Link</div><div class="strong" style="max-width:220px;overflow:hidden;text-overflow:ellipsis">Klar</div></div></div><p style="margin-top:10px;word-break:break-all"><strong>${url}</strong></p>`);
      });

      on('btnLead','click', ()=>{
        const ok = (state.engagement.adjusted || state.engagement.choice_clicked);
        if(!ok){ toast('Lav mindst én justering eller vælg et lille valg først.'); return; }
        screen('lead1');
      });

      on('payout','change', ()=>{
        $('#payoutCustomWrap').classList.toggle('hidden', $('#payout').value !== 'custom');
      });
      on('btnApply','click', ()=>{
        const v = $('#payout').value;
        let payout = 20000;
        if(v==='custom'){
          payout = parseInt($('#payoutCustom').value,10);
          if(!Number.isFinite(payout) || payout<5000){ $('#errPayout').classList.add('show'); toast('Udfyld referenceudbetaling.'); return; } else { $('#errPayout').classList.remove('show'); }
        } else payout = parseInt(v,10);
        state.assumptions.payout_target_monthly = payout;
        state.assumptions.return_rate = parseFloat($('#returnRate').value);
        renderSetupPreview(); renderHero(); renderAdjust(); renderChoices(); renderGain();
        screen('hero');
      });
      on('btnBackFromAssumptions','click', ()=>{ renderHero(); screen('hero'); });

      on('btnBackFromLead','click', ()=>{ renderGain(); screen('gain'); });

on('btnBackToPlan','click', ()=>{ renderGain(); screen('gain'); });
on('btnBackLead2','click', ()=>{ screen('lead1'); });
on('btnLeadNext','click', ()=>{
  const fn = ($('#firstName')?.value||'').trim();
  const em = ($('#email')?.value||'').trim();
  const err = $('#errLead1');
  if(!fn || !validateEmail(em)){
    if(err) err.classList.add('show');
    toast('Udfyld fornavn og email.');
    return;
  }
  if(err) err.classList.remove('show');
  screen('lead2');
});

      on('btnPreview','click', ()=>{ renderPreview(); screen('preview'); });
      on('btnBackFromPreview','click', ()=>{ screen('lead1'); });

      on('btnSubmit','click', ()=>{
        const now = Date.now();
        if(now - __lead_last_submit_at < 1200){ toast('Vent et øjeblik…'); return; }
        __lead_last_submit_at = now;
        const p = buildPayload();
        const arr = leadsGet();
        arr.push(p);
        leadsSet(arr);
        screen('thanks');
      });

      on('btnRestart','click', ()=>{
        state.profile.age = null;
        state.capital.current_savings = 0;
        state.scenario.extra_saving_manual = 0;
        state.scenario.selected_choices = new Set();
        state.ui.choices_offset = 0;
        $('#age').value = '';
        $('#extraMonthly').value = '';
        $('#currentSavings').value = '';
        $('#extraRange').value = 0;
        $('#extraManual').value = '';
        screen('start');
      });

      on('btnAdminGo','click', ()=>{ renderAdmin(); screen('admin'); });
      on('btnClear','click', ()=>{
        if(confirm('Slet alle leads i demo?')){ leadsSet([]); renderAdmin(); }
      });
      on('btnBackStart','click', softHome);

      
// Back buttons (V9.1)
on('btnBackInsp','click', ()=>goBackFrom('inspiration'));
on('btnBackSetup','click', ()=>goBackFrom('setup'));
on('btnBackHero','click', ()=>goBackFrom('hero'));
on('btnBackAdjustTop','click', ()=>goBackFrom('adjust'));
on('btnBackChoicesTop','click', ()=>goBackFrom('choices'));
on('btnBackAssumptionsTop','click', ()=>goBackFrom('assumptions'));
on('btnBackGainTop','click', ()=>goBackFrom('gain'));
on('btnBackLead1Top','click', ()=>goBackFrom('lead1'));
on('btnBackLead2Top','click', ()=>goBackFrom('lead2'));
on('btnBackPreviewTop','click', ()=>goBackFrom('preview'));
on('btnBackThanksTop','click', ()=>goBackFrom('thanks'));
on('btnBackAdminTop','click', ()=>goBackFrom('admin'));


on('btnUseInsp','click', ()=>{
  const amt = state.inspiration?.chosen_monthly ?? 0;
  if(!amt) return;
  hydrateSetupInputs();
  const inp = document.getElementById('extraMonthly');
  if(inp) inp.value = amt;
  state.scenario.extra_saving_manual = amt;
  state.engagement.adjusted = true;
  renderSetupPreview();
  screen('setup');
});
on('btnSkipInsp','click', ()=>{
  hydrateSetupInputs();
  renderSetupPreview();
  screen('setup');
});

wireNav();
      screen('start');
    }

    try{ init(); }catch(e){ logError('init', e?.message||e, null); const fab=$('#debugFab'); if(fab) fab.classList.add('show'); }
  
  
  
  

function fmtAgeSimple(x){ return fmtAgeConservative(x); }

function inspOptions(){
  // predefined monthly levels, conservative, not promises
  return [
    { tier:1, amount:300, label:'300 kr./md', note:'1 lille handling om ugen' },
    { tier:1, amount:600, label:'600 kr./md', note:'små vaner over tid' },
    { tier:1, amount:1000, label:'1.000 kr./md', note:'abonnementer + små greb' },
    { tier:2, amount:1500, label:'1.500 kr./md', note:'mellem-niveau justering' },
    { tier:2, amount:2500, label:'2.500 kr./md', note:'strammere struktur' },
    { tier:3, amount:4000, label:'4.000 kr./md', note:'større beslutning / indtægt' },
    { tier:3, amount:6000, label:'6.000 kr./md', note:'strategisk ændring' },
  ];
}

function renderInspiration(){
  const lists={1:document.getElementById('tier1List'),2:document.getElementById('tier2List'),3:document.getElementById('tier3List')};
  Object.values(lists).forEach(el=>{ if(el) el.innerHTML=''; });

  const opts=inspOptions();
  const chosen = state.inspiration?.chosen_monthly ?? 0;

  function mkCard(opt){
    const base = compute(0, null);
    const res = compute(opt.amount, null);
    const marginal = Math.max(0, res.deltaYears - base.deltaYears);
    const el=document.createElement('div');
    el.className='choiceItem';
    const active = (opt.amount===chosen);
    el.innerHTML = `
      <div>
        <div class="choiceTitle">${opt.label}</div>
        <div class="choiceMeta">${opt.note}</div>
      </div>
      <div class="toggle" style="min-width:140px">
        <span class="pill ${active?'good':''}">+ ${fmtDeltaConservative(marginal)}</span>
        <button class="switchBtn" type="button" data-insp="${opt.amount}">
          <div class="switch ${active?'on':''}"><div class="knob"></div></div>
        </button>
      </div>
    `;
    return el;
  }

  opts.forEach(opt=>{
    const root=lists[opt.tier];
    if(!root) return;
    root.appendChild(mkCard(opt));
  });

  document.querySelectorAll('[data-insp]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const amt = parseInt(btn.getAttribute('data-insp'),10) || 0;
      state.inspiration.chosen_monthly = amt;
      const chosenEl=document.getElementById('inspChosen');
      if(chosenEl) chosenEl.textContent = amt ? `${fmtInt(amt)} kr./md` : '—';
      const res = compute(amt, null);
      setText('inspPossible', fmtAgeConservative(res.possible));
      setText('inspDelta', fmtDeltaConservative(res.deltaYears));
      renderInspiration(); // rerender to update toggles
    });
  });

  const startRes = compute(chosen||0, null);
  setText('inspPossible', fmtAgeConservative(startRes.possible));
  setText('inspDelta', fmtDeltaConservative(startRes.deltaYears));
  setText('inspChosen', chosen?`${fmtInt(chosen)} kr./md`:'—');

  const btn = document.getElementById('btnUseInsp');
  if(btn) btn.classList.toggle('disabled', !chosen);
}
</script>

  <div class="toast" id="toast">—</div>

  <button type="button" class="debugFab" id="debugFab">Debug</button>


  <div class="modalOverlay" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalHead">
        <h3 class="modalTitle" id="modalTitle">—</h3>
        <button type="button" class="modalClose" id="modalClose">Luk</button>
      </div>
      <div class="modalBody" id="modalBody">—</div>
      <div class="stepDots" id="modalDots" aria-hidden="true"></div>
    </div>
  </div>

</body>
</html>
