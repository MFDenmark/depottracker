<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>TidsHjulet — Prototype V13</title>
<style>
:root{
  --bg:#070A12;
  --card:rgba(255,255,255,0.06);
  --card2:rgba(255,255,255,0.09);
  --stroke:rgba(255,255,255,0.10);
  --text:rgba(255,255,255,0.92);
  --muted:rgba(255,255,255,0.62);
  --muted2:rgba(255,255,255,0.45);
  --accent:#2F6BFF;
  --accent2:#12B3FF;
  --good:#22C55E;
  --warn:#F59E0B;
  --shadow:0 18px 50px rgba(0,0,0,0.55);
  --r:18px;
  --font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
}
*{box-sizing:border-box}
body{
  margin:0; font-family:var(--font); color:var(--text); background:
    radial-gradient(900px 520px at 20% 10%, rgba(47,107,255,0.25), transparent 60%),
    radial-gradient(900px 520px at 80% 20%, rgba(18,179,255,0.18), transparent 60%),
    radial-gradient(1000px 620px at 50% 90%, rgba(34,197,94,0.10), transparent 65%),
    linear-gradient(180deg, #060812, #070A12 55%, #050611);
  min-height:100vh;
}
.app{max-width:520px;margin:0 auto;padding:18px 14px 26px}

.top{
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 4px 14px; position:sticky; top:0; z-index:20;
  background: linear-gradient(180deg, rgba(7,10,18,0.92), rgba(7,10,18,0.50));
  backdrop-filter: blur(10px);
}
.brand{display:flex; align-items:center; gap:10px}
.dot{width:12px;height:12px;border-radius:999px;background:conic-gradient(from 180deg,var(--accent2),var(--accent),var(--accent2));
box-shadow:0 0 0 1px rgba(255,255,255,0.14),0 12px 26px rgba(47,107,255,0.18);}
.name{font-weight:850;letter-spacing:-0.01em}
.tag{font-size:12px;color:var(--muted)}

.card{background:var(--card);border:1px solid var(--stroke);border-radius:var(--r);box-shadow:var(--shadow);}
.pad{padding:16px}
.kicker{font-size:12px;color:var(--muted);letter-spacing:0.02em;text-transform:uppercase}
.h1{font-size:22px;font-weight:900;letter-spacing:-0.02em;line-height:1.15;margin:6px 0 0}
.p{font-size:13px;color:var(--muted);line-height:1.45;margin:10px 0 0}

.btnRow{display:flex;gap:10px;margin-top:14px}
button{border:0;border-radius:14px;padding:12px 12px;font-weight:850;cursor:pointer;transition:transform .08s ease, filter .18s ease, box-shadow .18s ease;}
button:active{transform:translateY(1px)}
.primary{flex:1;background:linear-gradient(135deg,var(--accent),#1B46D6);color:white;box-shadow:0 16px 34px rgba(47,107,255,0.22);}
.ghost{background:rgba(255,255,255,0.08);color:var(--text);border:1px solid rgba(255,255,255,0.10);}
.smallbtn{padding:10px 12px;font-size:13px}

.wheelWrap{margin-top:14px; display:flex; flex-direction:column; align-items:center; gap:12px}
.wheelCard{width:100%; padding:14px}
.wheelHeader{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
.badges{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
.badge{font-size:12px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.06);padding:6px 10px;border-radius:999px;color:rgba(255,255,255,0.78);}
.badge.good{border-color:rgba(34,197,94,0.28);background:rgba(34,197,94,0.10);color:rgba(200,255,220,0.90);}
.badge.warn{border-color:rgba(245,158,11,0.28);background:rgba(245,158,11,0.10);color:rgba(255,235,200,0.90);}

svg{max-width:420px;width:100%;height:auto;display:block}
.seg{cursor:pointer; transition: filter .18s ease, opacity .18s ease}
.seg:hover{filter: drop-shadow(0 14px 22px rgba(47,107,255,0.18));}
.core{cursor:pointer;}

.coreTextBig{font-size:44px;font-weight:950;letter-spacing:-0.04em;fill:rgba(255,255,255,0.94);}
.coreTextSmall{font-size:12px;fill:rgba(255,255,255,0.65);}
.coreTextDelta{font-size:14px;font-weight:850;fill:rgba(255,255,255,0.82);}
.coreTextBase{font-size:11px;fill:rgba(255,255,255,0.55);}

.progress{width:100%;display:flex;align-items:center;justify-content:space-between;margin-top:4px}
.prog{font-size:12px;color:var(--muted);}
.systemLine{font-size:14px;font-weight:800;letter-spacing:-0.01em;color:rgba(255,255,255,0.88);}

.sheetOverlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:none;z-index:60;}
.sheet{position:fixed;left:0;right:0;bottom:-100%;z-index:70;transition:bottom .22s ease;
  background: linear-gradient(180deg, rgba(18,21,35,0.92), rgba(12,14,24,0.95));
  border-top:1px solid rgba(255,255,255,0.12);
  border-radius: 18px 18px 0 0;
  box-shadow: 0 -22px 60px rgba(0,0,0,0.65);
}
.sheetInner{max-width:520px;margin:0 auto;padding:14px 14px 18px}
.sheetTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
.sheetTitle{font-size:15px;font-weight:900;letter-spacing:-0.01em;}
.sheetClose{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.10);color:var(--text);}
.hr{height:1px;background:rgba(255,255,255,0.10);margin:12px 0;}

label{display:block;font-size:12px;color:rgba(255,255,255,0.70);margin:10px 0 6px}
input[type="number"], select{width:100%;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,0.12);
background:rgba(255,255,255,0.06);color:var(--text);outline:none;}
input[type="range"]{width:100%}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.help{font-size:12px;color:rgba(255,255,255,0.58);line-height:1.35;margin-top:8px}

.chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.chip{
  padding:10px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.12);
  background:rgba(255,255,255,0.06); color:rgba(255,255,255,0.86);
  font-size:13px; font-weight:750; cursor:pointer; user-select:none;
}
.chip.on{border-color:rgba(18,179,255,0.35);background:rgba(18,179,255,0.12);}
.pager{display:flex;align-items:center;justify-content:space-between;margin-top:12px;color:rgba(255,255,255,0.70);font-size:12px;}

.ctaBox{margin-top:14px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.10);border-radius:16px;padding:14px}
.ctaTitle{font-weight:900;letter-spacing:-0.01em}
.ctaSub{font-size:12px;color:rgba(255,255,255,0.62);margin-top:6px;line-height:1.35}
.ctaRow{display:flex;gap:10px;margin-top:12px}
input[type="checkbox"]{transform:scale(1.1)}
.consentRow{display:flex;align-items:flex-start;gap:10px;margin-top:10px;color:rgba(255,255,255,0.72);font-size:12px;line-height:1.35}

.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:rgba(18,179,255,0.12);
border:1px solid rgba(18,179,255,0.22);padding:10px 12px;border-radius:999px;display:none;z-index:90;color:rgba(255,255,255,0.90);
box-shadow:0 18px 45px rgba(0,0,0,0.55);}

@media (prefers-reduced-motion: reduce){
  .sheet{transition:none} .seg{transition:none} button{transition:none}
}
</style>
</head>
<body>
<div class="app">
  <div class="top">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="name">TidsHjulet</div>
        <div class="tag">Prototype V13 · frihed i år, ikke procenter</div>
      </div>
    </div>
    <button class="ghost smallbtn" id="btnAssump">Forudsætninger</button>
  </div>

  <div class="card pad" id="introCard">
    <div class="kicker">Start</div>
    <div class="h1">Hvor mange år kan du frigøre?</div>
    <div class="p">Indtast din fødselsdato. Vi bruger den til at beregne din officielle folkepensionsalder (vejledende).</div>
    <div class="row2" style="margin-top:12px">
      <div>
        <label>Fødselsår</label>
        <input id="birthYear" type="number" inputmode="numeric" placeholder="fx 1988" min="1900" max="2026">
      </div>
      <div>
        <label>Fødselsmåned</label>
        <select id="birthMonth">
          <option value="1" selected>Januar</option><option value="2">Februar</option><option value="3">Marts</option>
          <option value="4">April</option><option value="5">Maj</option><option value="6">Juni</option>
          <option value="7">Juli</option><option value="8">August</option><option value="9">September</option>
          <option value="10">Oktober</option><option value="11">November</option><option value="12">December</option>
        </select>
      </div>
    </div>
    <div class="btnRow">
      <button class="primary" id="btnStart">Start</button>
      <button class="ghost" id="btnDemo">Demo</button>
    </div>
    <div class="help">Demo udfylder eksempeldata. Du kan altid ændre dem.</div>
  </div>

  <div class="card wheelCard" id="wheelCard" style="display:none">
    <div class="wheelHeader">
      <div>
        <div class="kicker">Din frihed</div>
        <div class="h1" style="margin-top:6px">Du styrer 3 håndtag</div>
        <div class="p" id="subLine">Tryk på et felt for at justere. Tryk på midten for detaljer.</div>
      </div>
      <div class="badges">
        <div class="badge" id="badgeBase">Folkepension: –</div>
        <div class="badge good" id="badgeProg">0/3 aktiveret</div>
      </div>
    </div>

    <div class="wheelWrap">
      <svg viewBox="0 0 420 420" aria-label="Tids-hjul">
        <circle cx="210" cy="210" r="172" fill="rgba(255,255,255,0.03)" stroke="rgba(255,255,255,0.10)" stroke-width="2"/>
        <path id="seg1" class="seg" d="" fill="rgba(47,107,255,0.18)" stroke="rgba(255,255,255,0.10)" stroke-width="2"/>
        <path id="seg2" class="seg" d="" fill="rgba(18,179,255,0.14)" stroke="rgba(255,255,255,0.10)" stroke-width="2"/>
        <path id="seg3" class="seg" d="" fill="rgba(34,197,94,0.10)" stroke="rgba(255,255,255,0.10)" stroke-width="2"/>

        <circle id="core" class="core" cx="210" cy="210" r="78" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.12)" stroke-width="2"/>
        <text x="210" y="194" text-anchor="middle" class="coreTextBase" id="coreBase">Officiel: –</text>
        <text x="210" y="242" text-anchor="middle" class="coreTextBig" id="coreAge">–</text>
        <text x="210" y="262" text-anchor="middle" class="coreTextSmall">år</text>
        <text x="210" y="286" text-anchor="middle" class="coreTextDelta" id="coreDelta">–</text>

        <text x="210" y="70" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.80)" font-weight="800">Indsats</text>
        <text x="335" y="290" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.80)" font-weight="800">Struktur</text>
        <text x="85" y="290" text-anchor="middle" font-size="12" fill="rgba(255,255,255,0.80)" font-weight="800">Små valg</text>
      </svg>

      <div class="progress">
        <div class="prog" id="progLine">Juster et felt for at se effekt.</div>
        <div class="systemLine" id="systemLine"></div>
      </div>
    </div>

    <div class="ctaBox" id="ctaBox" style="display:none">
      <div class="ctaTitle" id="ctaTitle">Få en plan baseret på dine valg</div>
      <div class="ctaSub" id="ctaSub">Frivilligt. Ingen forpligtelse. Du bestemmer selv om du vil kontaktes.</div>
      <div class="ctaRow">
        <button class="primary" id="btnPlan">Få planen</button>
        <button class="ghost" id="btnLater">Send til mig senere</button>
      </div>
      <div id="leadArea" style="display:none;margin-top:12px">
        <div class="row2">
          <div>
            <label>Fornavn</label>
            <input id="leadName" type="text" placeholder="Dit navn">
          </div>
          <div>
            <label>Email</label>
            <input id="leadEmail" type="text" placeholder="navn@email.dk">
          </div>
        </div>
        <div class="consentRow">
          <input type="checkbox" id="leadConsent">
          <div>Jeg ønsker at blive kontaktet om en plan. (Uden samtykke gemmes kun “send senere”.)</div>
        </div>
        <div class="btnRow" style="margin-top:10px">
          <button class="primary" id="btnSend">Send (demo)</button>
          <button class="ghost" id="btnCancelLead">Luk</button>
        </div>
        <div class="help">Demo gemmer lokalt i din browser (localStorage). Der sendes intet.</div>
      </div>
    </div>
  </div>
</div>

<div class="sheetOverlay" id="overlay"></div>
<div class="sheet" id="sheet">
  <div class="sheetInner">
    <div class="sheetTop">
      <div class="sheetTitle" id="sheetTitle">—</div>
      <button class="sheetClose smallbtn" id="sheetClose">Luk</button>
    </div>
    <div class="hr"></div>
    <div id="sheetBody"></div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
const BUILD_ID = "TH-V13-2026-02-20";
const $ = (id)=>document.getElementById(id);

const state = {
  birthYear:null,
  birthMonth:1,
  pensionAge:null,
  pensionStatus:"vedtaget",
  currentSavings: 0,
  extraMonthly: 0,
  structureMode: "std",
  returnRate: 0.06,
  choicesPage: 0,
  choicesOn: new Set(),
};

const CHOICES = [
  {id:"c1", label:"Småferie: 1 uge", monthly: 600},
  {id:"c2", label:"2 caféer færre", monthly: 250},
  {id:"c3", label:"1 streaming mindre", monthly: 99},
  {id:"c4", label:"Take-away 2x mindre", monthly: 500},
  {id:"c5", label:"Impulskøb færre", monthly: 400},
  {id:"c6", label:"Transport: cykel 2 dage", monthly: 300},
  {id:"c7", label:"Abonnement-scan", monthly: 150},
  {id:"c8", label:"Færre snacks", monthly: 200},
  {id:"c9", label:"Køb brugt 1x", monthly: 350},
  {id:"c10", label:"Strøm: 5% ned", monthly: 180},
];
const PAGE_SIZE = 5;

function toast(msg){
  const t=$("toast"); t.textContent=msg; t.style.display="block";
  clearTimeout(toast._tm); toast._tm=setTimeout(()=>t.style.display="none",1600);
}

function pensionAgeFromDOB(year, month){
  const y = year;
  const m = month;

  // STAR table cutoffs include July boundaries for some years.
  if (y < 1955 || (y===1955 && m < 7)) {
    return {age:67, status:"vedtaget", note:"Ældre årgange har særlige overgangsregler; her vises 67 som reference."};
  }
  if (y < 1963) return {age:67, status:"vedtaget", note:""};
  if (y < 1967) return {age:68, status:"vedtaget", note:""};
  if (y < 1971) return {age:69, status:"vedtaget", note:""};
  if (y < 1975) return {age:70, status:"vedtaget", note:""};

  if (y < 1979) return {age:71, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
  if (y < 1983) return {age:72, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
  if (y < 1987 || (y===1987 && m < 7)) return {age:72.5, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
  if (y < 1992) return {age:73, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
  if (y < 1996 || (y===1996 && m < 7)) return {age:73.5, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
  return {age:74, status:"skøn", note:"Folkepensionsalder fra 2045 er et skøn og vedtages først senere."};
}

function polarToXY(cx, cy, r, angleDeg){
  const a = (angleDeg-90) * Math.PI/180;
  return {x: cx + r*Math.cos(a), y: cy + r*Math.sin(a)};
}
function arcPath(cx, cy, rOuter, rInner, startDeg, endDeg){
  const p1 = polarToXY(cx, cy, rOuter, startDeg);
  const p2 = polarToXY(cx, cy, rOuter, endDeg);
  const p3 = polarToXY(cx, cy, rInner, endDeg);
  const p4 = polarToXY(cx, cy, rInner, startDeg);
  const large = (endDeg-startDeg) > 180 ? 1 : 0;
  return [
    `M ${p1.x.toFixed(2)} ${p1.y.toFixed(2)}`,
    `A ${rOuter} ${rOuter} 0 ${large} 1 ${p2.x.toFixed(2)} ${p2.y.toFixed(2)}`,
    `L ${p3.x.toFixed(2)} ${p3.y.toFixed(2)}`,
    `A ${rInner} ${rInner} 0 ${large} 0 ${p4.x.toFixed(2)} ${p4.y.toFixed(2)}`,
    "Z"
  ].join(" ");
}

function setWheelPaths(){
  const cx=210, cy=210, ro=172, ri=92;
  $("seg1").setAttribute("d", arcPath(cx,cy,ro,ri, -60, 60));      // top
  $("seg2").setAttribute("d", arcPath(cx,cy,ro,ri, 60, 180));      // bottom-right
  $("seg3").setAttribute("d", arcPath(cx,cy,ro,ri, 180, 300));     // bottom-left
}

function activeCount(){
  let n=0;
  if (state.extraMonthly>0 || state.currentSavings>0) n++;
  if (state.structureMode!=="std") n++;
  if (state.choicesOn.size>0) n++;
  return n;
}

function totalChoicesMonthly(){
  let sum=0;
  for (const id of state.choicesOn) {
    const c = CHOICES.find(x=>x.id===id);
    if (c) sum += c.monthly;
  }
  return sum;
}

function computeFreedom(){
  const baseAge = state.pensionAge;
  const currentYear = new Date().getFullYear();
  const ageNow = currentYear - state.birthYear; // approx
  const years = Math.max(0, baseAge - ageNow);

  const r = state.returnRate;
  const extra = state.extraMonthly + totalChoicesMonthly();
  const savings = state.currentSavings;

  const futureSavings = savings * Math.pow(1+r, years);
  const futureExtra = (extra*12) * (r===0 ? years : ((Math.pow(1+r, years)-1)/r));
  const total = futureSavings + futureExtra;

  const needed = 20000*12*20;
  const ratio = needed>0 ? total/needed : 0;
  const maxYears = years * 0.45;
  const yearsGained = Math.max(0, Math.min(maxYears, ratio*maxYears));

  const freedomAge = baseAge - yearsGained;
  return {ageNow, baseAge, freedomAge, yearsGained};
}

function updateUI(){
  const res = computeFreedom();
  const ageNow = res.ageNow, baseAge = res.baseAge, freedomAge = res.freedomAge, yearsGained = res.yearsGained;

  $("badgeBase").textContent = `Folkepension: ${baseAge} år${state.pensionStatus==="skøn" ? " (skøn)" : ""}`;
  $("coreBase").textContent = `Officiel: ${baseAge} år${state.pensionStatus==="skøn" ? " (skøn)" : ""}`;
  $("coreAge").textContent = (Math.round(freedomAge*10)/10).toString();
  $("coreDelta").textContent = yearsGained < 0.05 ? "Start med ét felt" : `Mulighed: ca. ${(Math.round(yearsGained*10)/10)} år tidligere`;

  const act = activeCount();
  $("badgeProg").textContent = `${act}/3 aktiveret`;

  $("progLine").textContent = act===0
    ? "Tryk på et felt for at begynde."
    : act===1 ? "Godt. Prøv et felt mere og se springet."
    : act===2 ? "Du har momentum. Prøv også det sidste felt."
    : "Du har aktiveret alle håndtag.";

  $("systemLine").textContent = (act>=2 && yearsGained>=0.2)
    ? `Du har allerede skabt mulighed for ${(Math.round(yearsGained*10)/10)} år tidligere.`
    : "";

  $("seg1").style.opacity = (state.extraMonthly>0 || state.currentSavings>0) ? "1" : "0.55";
  $("seg2").style.opacity = (state.structureMode!=="std") ? "1" : "0.55";
  $("seg3").style.opacity = (state.choicesOn.size>0) ? "1" : "0.55";

  const showCTA = act>=2;
  $("ctaBox").style.display = showCTA ? "block" : "none";

  if (showCTA){
    const focus = (state.choicesOn.size>0 && state.extraMonthly===0) ? "små valg"
                : (state.extraMonthly>0 && state.choicesOn.size===0) ? "investering"
                : "valg";
    $("ctaTitle").textContent = focus==="små valg"
      ? "Få en plan der gør små valg til varig frihed"
      : focus==="investering"
        ? "Få en plan der gør din investering til tidligere frihed"
        : "Få en plan baseret på dine valg";
  }
}

function openSheet(title, bodyHtml){
  $("sheetTitle").textContent = title;
  $("sheetBody").innerHTML = bodyHtml;
  $("overlay").style.display = "block";
  $("sheet").style.bottom = "0";
}
function closeSheet(){
  $("overlay").style.display = "none";
  $("sheet").style.bottom = "-100%";
}

function renderChoices(page){
  state.choicesPage = page;
  const start = page*PAGE_SIZE;
  const items = CHOICES.slice(start, start+PAGE_SIZE);
  const chips = items.map(c=>{
    const on = state.choicesOn.has(c.id) ? "on" : "";
    return `<div class="chip ${on}" data-choice="${c.id}">${c.label} · ${c.monthly} kr./md</div>`;
  }).join("");
  const totalPages = Math.ceil(CHOICES.length/PAGE_SIZE);
  return `
    <div class="help">Vælg 1–3 ting. Små valg kan skabe store år over tid.</div>
    <div class="chips" id="chips">${chips}</div>
    <div class="pager">
      <button class="ghost smallbtn" id="prevPg" ${page===0?"disabled":""}>Forrige</button>
      <div>Side ${page+1}/${totalPages} · Valgt: ${state.choicesOn.size}</div>
      <button class="ghost smallbtn" id="nextPg" ${page===totalPages-1?"disabled":""}>Næste</button>
    </div>
  `;
}

function showIndsats(){
  openSheet("Indsats", `
    <label>Ekstra investering pr. måned (kr.)</label>
    <input type="range" id="extraRange" min="0" max="15000" step="250" value="${state.extraMonthly}">
    <div class="help"><span id="extraVal">${state.extraMonthly}</span> kr./md</div>

    <label>Opsparing i dag (kr.)</label>
    <input type="number" id="savInp" inputmode="numeric" min="0" value="${state.currentSavings}" placeholder="fx 250000">

    <div class="help">Målet er enkelhed: ét beløb du kan holde, og det du allerede har.</div>
  `);
  $("extraRange").addEventListener("input", (e)=>{
    state.extraMonthly = parseInt(e.target.value||"0",10);
    $("extraVal").textContent = state.extraMonthly;
    updateUI();
  });
  $("savInp").addEventListener("input", (e)=>{
    state.currentSavings = Math.max(0, parseInt(e.target.value||"0",10));
    updateUI();
  });
}

function showStruktur(){
  openSheet("Struktur", `
    <label>Stil</label>
    <select id="modeSel">
      <option value="cons" ${state.structureMode==="cons"?"selected":""}>Lav risiko (5%)</option>
      <option value="std" ${state.structureMode==="std"?"selected":""}>Balanceret (6%)</option>
      <option value="grow" ${state.structureMode==="grow"?"selected":""}>Mere vækst (7%)</option>
    </select>
    <div class="help">Det her er en forudsætning – ikke en garanti. Du kan se detaljer i “Forudsætninger”.</div>
  `);
  $("modeSel").addEventListener("change",(e)=>{
    state.structureMode = e.target.value;
    state.returnRate = state.structureMode==="cons" ? 0.05 : state.structureMode==="grow" ? 0.07 : 0.06;
    updateUI();
  });
}

function showSmaaValg(){
  openSheet("Små valg", renderChoices(state.choicesPage));
  const attach = ()=>{
    const chipsEl = $("chips");
    if (chipsEl) chipsEl.addEventListener("click",(e)=>{
      const el = e.target.closest(".chip");
      if (!el) return;
      const id = el.getAttribute("data-choice");
      if (state.choicesOn.has(id)) state.choicesOn.delete(id); else state.choicesOn.add(id);
      showSmaaValg();
      updateUI();
    });
    const totalPages = Math.ceil(CHOICES.length/PAGE_SIZE);
    const prev = $("prevPg"), next = $("nextPg");
    if (prev) prev.addEventListener("click",()=>{ if (state.choicesPage>0) { state.choicesPage--; showSmaaValg(); updateUI(); } });
    if (next) next.addEventListener("click",()=>{ if (state.choicesPage<totalPages-1) { state.choicesPage++; showSmaaValg(); updateUI(); } });
  };
  setTimeout(attach,0);
}

function showAssumptions(){
  const p = pensionAgeFromDOB(state.birthYear||1988, state.birthMonth||1);
  openSheet("Forudsætninger", `
    <div class="help">
      <div><b>Folkepensionsalder:</b> ${p.age} år ${p.status==="skøn" ? "(skøn)" : "(vedtaget)"}</div>
      <div style="margin-top:6px"><b>Afkastforudsætning:</b> ${Math.round(state.returnRate*100)}%</div>
      <div style="margin-top:6px"><b>Inflation:</b> Tal er nominelle (ikke inflationskorrigerede).</div>
      <div style="margin-top:6px"><b>Usikkerhed:</b> Se resultater som et estimat, ikke garanti.</div>
      ${p.note ? `<div style="margin-top:6px"><b>Note:</b> ${p.note}</div>` : ""}
      <div style="margin-top:10px;color:rgba(255,255,255,0.55)">
        Demo: ingen data sendes. Leads gemmes lokalt.
      </div>
    </div>
  `);
}

function showLead(){ $("leadArea").style.display = "block"; }
function hideLead(){ $("leadArea").style.display = "none"; }

function saveLead(kind){
  const name = ($("leadName").value||"").trim();
  const email = ($("leadEmail").value||"").trim();
  if (!email) { toast("Email mangler"); return; }
  const consent = $("leadConsent").checked;

  const payload = {
    build: BUILD_ID,
    kind,
    consent,
    name,
    email,
    created_at: new Date().toISOString(),
    birthYear: state.birthYear,
    birthMonth: state.birthMonth,
    pensionAge: state.pensionAge,
    pensionStatus: state.pensionStatus,
    currentSavings: state.currentSavings,
    extraMonthly: state.extraMonthly,
    choicesMonthly: totalChoicesMonthly(),
    returnRate: state.returnRate,
    active: activeCount(),
  };
  const key = "th_leads";
  const arr = JSON.parse(localStorage.getItem(key) || "[]");
  arr.push(payload);
  localStorage.setItem(key, JSON.stringify(arr));
  toast(consent ? "Kontakt gemt (demo)" : "Send senere gemt (demo)");
  hideLead();
}

function bootAfterBirth(){
  const y = parseInt($("birthYear").value||"",10);
  const m = parseInt($("birthMonth").value||"1",10);
  if (!y || y<1900 || y>2026) { toast("Ugyldigt fødselsår"); return; }
  state.birthYear = y;
  state.birthMonth = m;

  const p = pensionAgeFromDOB(y,m);
  state.pensionAge = p.age;
  state.pensionStatus = p.status;

  $("introCard").style.display = "none";
  $("wheelCard").style.display = "block";

  $("coreDelta").textContent = "Start med ét felt";
  updateUI();
}

setWheelPaths();
$("btnStart").addEventListener("click", bootAfterBirth);
$("btnDemo").addEventListener("click", ()=>{
  $("birthYear").value = 1988; $("birthMonth").value = 7;
  bootAfterBirth();
  state.currentSavings = 250000;
  state.extraMonthly = 1500;
  state.structureMode = "std"; state.returnRate = 0.06;
  state.choicesOn = new Set(["c1","c3"]);
  updateUI();
});

$("seg1").addEventListener("click", showIndsats);
$("seg2").addEventListener("click", showStruktur);
$("seg3").addEventListener("click", showSmaaValg);
$("core").addEventListener("click", showAssumptions);
$("btnAssump").addEventListener("click", showAssumptions);

$("overlay").addEventListener("click", closeSheet);
$("sheetClose").addEventListener("click", closeSheet);

$("btnPlan").addEventListener("click", ()=>{ showLead(); });
$("btnLater").addEventListener("click", ()=>{ showLead(); $("leadConsent").checked = false; });
$("btnCancelLead").addEventListener("click", hideLead);
$("btnSend").addEventListener("click", ()=>{ saveLead($("leadConsent").checked ? "contact" : "later"); });
</script>
</body>
</html>
